!function webpackUniversalModuleDefinition(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.r46v3=r():t.r46v3=r()}(self,(()=>(()=>{var t={332:(t,r,o)=>{"use strict";var i=o(91),a=[],c=[],l=i.makeRequestCallFromTimer((function throwFirstError(){if(c.length)throw c.shift()}));function asap(t){var r;(r=a.length?a.pop():new RawTask).task=t,i(r)}function RawTask(){this.task=null}t.exports=asap,RawTask.prototype.call=function(){try{this.task.call()}catch(t){asap.onerror?asap.onerror(t):(c.push(t),l())}finally{this.task=null,a[a.length]=this}}},91:(t,r,o)=>{"use strict";function rawAsap(t){a.length||(i(),!0),a[a.length]=t}t.exports=rawAsap;var i,a=[],c=0;function flush(){for(;c<a.length;){var t=c;if(c+=1,a[t].call(),c>1024){for(var r=0,o=a.length-c;r<o;r++)a[r]=a[r+c];a.length-=c,c=0}}a.length=0,c=0,!1}var l=void 0!==o.g?o.g:self,u=l.MutationObserver||l.WebKitMutationObserver;function makeRequestCallFromTimer(t){return function requestCall(){var r=setTimeout(handleTimer,0),o=setInterval(handleTimer,50);function handleTimer(){clearTimeout(r),clearInterval(o),t()}}}i="function"==typeof u?function makeRequestCallFromMutationObserver(t){var r=1,o=new u(t),i=document.createTextNode("");return o.observe(i,{characterData:!0}),function requestCall(){r=-r,i.data=r}}(flush):makeRequestCallFromTimer(flush),rawAsap.requestFlush=i,rawAsap.makeRequestCallFromTimer=makeRequestCallFromTimer},289:(t,r,o)=>{var i=!!(o.g===o.g.window&&o.g.URL&&o.g.Blob&&o.g.Worker);function InlineWorker(t,r){var a,c=this;if(r=r||{},i)return a=t.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],new o.g.Worker(o.g.URL.createObjectURL(new o.g.Blob([a],{type:"text/javascript"})));this.self=r,this.self.postMessage=function postMessage(t){setTimeout((function(){c.onmessage({data:t})}),0)},setTimeout(t.bind(r,r),0)}InlineWorker.prototype.postMessage=function postMessage(t){var r=this;setTimeout((function(){r.self.onmessage({data:t})}),0)},t.exports=InlineWorker},630:(t,r,o)=>{"use strict";t.exports=o(858)},23:(t,r,o)=>{"use strict";var i=o(91);function noop(){}var a=null,c={};function Promise(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("Promise constructor's argument is not a function");this._40=0,this._65=0,this._55=null,this._72=null,t!==noop&&doResolve(t,this)}function handle(t,r){for(;3===t._65;)t=t._55;if(Promise._37&&Promise._37(t),0===t._65)return 0===t._40?(t._40=1,void(t._72=r)):1===t._40?(t._40=2,void(t._72=[t._72,r])):void t._72.push(r);!function handleResolved(t,r){i((function(){var o=1===t._65?r.onFulfilled:r.onRejected;if(null!==o){var i=function tryCallOne(t,r){try{return t(r)}catch(t){return a=t,c}}(o,t._55);i===c?reject(r.promise,a):resolve(r.promise,i)}else 1===t._65?resolve(r.promise,t._55):reject(r.promise,t._55)}))}(t,r)}function resolve(t,r){if(r===t)return reject(t,new TypeError("A promise cannot be resolved with itself."));if(r&&("object"==typeof r||"function"==typeof r)){var o=function getThen(t){try{return t.then}catch(t){return a=t,c}}(r);if(o===c)return reject(t,a);if(o===t.then&&r instanceof Promise)return t._65=3,t._55=r,void finale(t);if("function"==typeof o)return void doResolve(o.bind(r),t)}t._65=1,t._55=r,finale(t)}function reject(t,r){t._65=2,t._55=r,Promise._87&&Promise._87(t,r),finale(t)}function finale(t){if(1===t._40&&(handle(t,t._72),t._72=null),2===t._40){for(var r=0;r<t._72.length;r++)handle(t,t._72[r]);t._72=null}}function Handler(t,r,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof r?r:null,this.promise=o}function doResolve(t,r){var o=!1,i=function tryCallTwo(t,r,o){try{t(r,o)}catch(t){return a=t,c}}(t,(function(t){o||(o=!0,resolve(r,t))}),(function(t){o||(o=!0,reject(r,t))}));o||i!==c||(o=!0,reject(r,a))}t.exports=Promise,Promise._37=null,Promise._87=null,Promise._61=noop,Promise.prototype.then=function(t,r){if(this.constructor!==Promise)return function safeThen(t,r,o){return new t.constructor((function(i,a){var c=new Promise(noop);c.then(i,a),handle(t,new Handler(r,o,c))}))}(this,t,r);var o=new Promise(noop);return handle(this,new Handler(t,r,o)),o}},76:(t,r,o)=>{"use strict";var i=o(23);t.exports=i,i.prototype.done=function(t,r){(arguments.length?this.then.apply(this,arguments):this).then(null,(function(t){setTimeout((function(){throw t}),0)}))}},891:(t,r,o)=>{"use strict";var i=o(23);t.exports=i;var a=valuePromise(!0),c=valuePromise(!1),l=valuePromise(null),u=valuePromise(void 0),d=valuePromise(0),p=valuePromise("");function valuePromise(t){var r=new i(i._61);return r._65=1,r._55=t,r}i.resolve=function(t){if(t instanceof i)return t;if(null===t)return l;if(void 0===t)return u;if(!0===t)return a;if(!1===t)return c;if(0===t)return d;if(""===t)return p;if("object"==typeof t||"function"==typeof t)try{var r=t.then;if("function"==typeof r)return new i(r.bind(t))}catch(t){return new i((function(r,o){o(t)}))}return valuePromise(t)},i.all=function(t){var r=Array.prototype.slice.call(t);return new i((function(t,o){if(0===r.length)return t([]);var a=r.length;function res(c,l){if(l&&("object"==typeof l||"function"==typeof l)){if(l instanceof i&&l.then===i.prototype.then){for(;3===l._65;)l=l._55;return 1===l._65?res(c,l._55):(2===l._65&&o(l._55),void l.then((function(t){res(c,t)}),o))}var u=l.then;if("function"==typeof u)return void new i(u.bind(l)).then((function(t){res(c,t)}),o)}r[c]=l,0==--a&&t(r)}for(var c=0;c<r.length;c++)res(c,r[c])}))},i.reject=function(t){return new i((function(r,o){o(t)}))},i.race=function(t){return new i((function(r,o){t.forEach((function(t){i.resolve(t).then(r,o)}))}))},i.prototype.catch=function(t){return this.then(null,t)}},597:(t,r,o)=>{"use strict";var i=o(23);t.exports=i,i.prototype.finally=function(t){return this.then((function(r){return i.resolve(t()).then((function(){return r}))}),(function(r){return i.resolve(t()).then((function(){throw r}))}))}},858:(t,r,o)=>{"use strict";t.exports=o(23),o(76),o(597),o(891),o(239),o(47)},239:(t,r,o)=>{"use strict";var i=o(23),a=o(332);t.exports=i,i.denodeify=function(t,r){return"number"==typeof r&&r!==1/0?function denodeifyWithCount(t,r){for(var o=[],a=0;a<r;a++)o.push("a"+a);var l="return function ("+o.join(",")+") {var self = this;return new Promise(function (rs, rj) {var res = fn.call("+["self"].concat(o).concat([c]).join(",")+');if (res &&(typeof res === "object" || typeof res === "function") &&typeof res.then === "function") {rs(res);}});};';return Function(["Promise","fn"],l)(i,t)}(t,r):function denodeifyWithoutCount(t){for(var r=Math.max(t.length-1,3),o=[],a=0;a<r;a++)o.push("a"+a);var l="return function ("+o.join(",")+") {var self = this;var args;var argLength = arguments.length;if (arguments.length > "+r+") {args = new Array(arguments.length + 1);for (var i = 0; i < arguments.length; i++) {args[i] = arguments[i];}}return new Promise(function (rs, rj) {var cb = "+c+";var res;switch (argLength) {"+o.concat(["extra"]).map((function(t,r){return"case "+r+":res = fn.call("+["self"].concat(o.slice(0,r)).concat("cb").join(",")+");break;"})).join("")+'default:args[argLength] = cb;res = fn.apply(self, args);}if (res &&(typeof res === "object" || typeof res === "function") &&typeof res.then === "function") {rs(res);}});};';return Function(["Promise","fn"],l)(i,t)}(t)};var c="function (err, res) {if (err) { rj(err); } else { rs(res); }}";i.nodeify=function(t){return function(){var r=Array.prototype.slice.call(arguments),o="function"==typeof r[r.length-1]?r.pop():null,c=this;try{return t.apply(this,arguments).nodeify(o,c)}catch(t){if(null==o)return new i((function(r,o){o(t)}));a((function(){o.call(c,t)}))}}},i.prototype.nodeify=function(t,r){if("function"!=typeof t)return this;this.then((function(o){a((function(){t.call(r,null,o)}))}),(function(o){a((function(){t.call(r,o)}))}))}},47:(t,r,o)=>{"use strict";var i=o(23);t.exports=i,i.enableSynchronous=function(){i.prototype.isPending=function(){return 0==this.getState()},i.prototype.isFulfilled=function(){return 1==this.getState()},i.prototype.isRejected=function(){return 2==this.getState()},i.prototype.getValue=function(){if(3===this._65)return this._55.getValue();if(!this.isFulfilled())throw Error("Cannot get a value of an unfulfilled promise.");return this._55},i.prototype.getReason=function(){if(3===this._65)return this._55.getReason();if(!this.isRejected())throw Error("Cannot get a rejection reason of a non-rejected promise.");return this._55},i.prototype.getState=function(){return 3===this._65?this._55.getState():-1===this._65||-2===this._65?0:this._65}},i.disableSynchronous=function(){i.prototype.isPending=void 0,i.prototype.isFulfilled=void 0,i.prototype.isRejected=void 0,i.prototype.getValue=void 0,i.prototype.getReason=void 0,i.prototype.getState=void 0}},930:t=>{"use strict";var stringifyPrimitive=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,r,o,i){return r=r||"&",o=o||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(i){var a=encodeURIComponent(stringifyPrimitive(i))+o;return Array.isArray(t[i])?t[i].map((function(t){return a+encodeURIComponent(stringifyPrimitive(t))})).join(r):a+encodeURIComponent(stringifyPrimitive(t[i]))})).join(r):i?encodeURIComponent(stringifyPrimitive(i))+o+encodeURIComponent(stringifyPrimitive(t)):""}},931:(t,r)=>{"use strict";Object.defineProperty(r,"B",{value:!0}),r.U=void 0,r.U=["limit","page","offset","available","category-names","sort-by","order","filters","locations","merchants","price-min","price-max","categories","brands","category-limit","brand-limit"]},835:function(t,r,o){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,r,o,i){void 0===i&&(i=o);var a=Object.getOwnPropertyDescriptor(r,o);a&&!("get"in a?!r.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(t,i,a)}:function(t,r,o,i){void 0===i&&(i=o),t[i]=r[o]}),a=this&&this.__exportStar||function(t,r){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(r,o)||i(r,t,o)};Object.defineProperty(r,"__esModule",{value:!0}),a(o(497),r)},497:function(t,r,o){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0}),r.isSessionExpired=void 0;const a=i(o(428)),c=o(687),l=o(687);r.isSessionExpired=t=>{const r=a.default.get(t+"_session_last_act");return!r||parseInt(r)<(new Date).getTime()-l.SESSION_CODE_EXPIRE*c.ONE_HOUR_IN_MILLISECONDS}},205:(t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getCopyIconElement=void 0;r.getCopyIconElement=()=>{const t=document.createElement("div");return t.style.cursor="pointer",t.innerHTML='\n  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path \n      fill-rule="evenodd" \n      clip-rule="evenodd" \n      d="M5.55556 3.88889C5.55556 1.74112 7.29667 0 9.44444 0H16.1111C18.2589 0 20 1.74112 20 3.88889V10.5556C20 12.7033 18.2589 14.4444 16.1111 14.4444H14.4444V16.1111C14.4444 18.2589 12.7033 20 10.5556 20H3.88889C1.74112 20 0 18.2589 0 16.1111V9.44444C0 7.29667 1.74112 5.55556 3.88889 5.55556H5.55556V3.88889ZM7.77778 5.55556H10.5556C12.7033 5.55556 14.4444 7.29667 14.4444 9.44444V12.2222H16.1111C17.0316 12.2222 17.7778 11.476 17.7778 10.5556V3.88889C17.7778 2.96841 17.0316 2.22222 16.1111 2.22222H9.44444C8.52397 2.22222 7.77778 2.96841 7.77778 3.88889V5.55556ZM2.22222 9.44444C2.22222 8.52397 2.96841 7.77778 3.88889 7.77778H10.5556C11.476 7.77778 12.2222 8.52397 12.2222 9.44444V16.1111C12.2222 17.0316 11.476 17.7778 10.5556 17.7778H3.88889C2.96841 17.7778 2.22222 17.0316 2.22222 16.1111V9.44444Z" \n      fill="white" \n      fill-opacity="0.3"/>\n  </svg>\n  ',t}},984:function(t,r,o){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,r,o,i){void 0===i&&(i=o);var a=Object.getOwnPropertyDescriptor(r,o);a&&!("get"in a?!r.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(t,i,a)}:function(t,r,o,i){void 0===i&&(i=o),t[i]=r[o]}),a=this&&this.__exportStar||function(t,r){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(r,o)||i(r,t,o)};Object.defineProperty(r,"__esModule",{value:!0}),a(o(205),r)},34:function(t,r,o){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,r,o,i){void 0===i&&(i=o);var a=Object.getOwnPropertyDescriptor(r,o);a&&!("get"in a?!r.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(t,i,a)}:function(t,r,o,i){void 0===i&&(i=o),t[i]=r[o]}),a=this&&this.__exportStar||function(t,r){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(r,o)||i(r,t,o)};Object.defineProperty(r,"__esModule",{value:!0}),a(o(941),r)},941:(t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PROMOCODE_COPY_TEXT=void 0,r.PROMOCODE_COPY_TEXT="Copied"},60:(t,r,o)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createCopyPromocodeBtn=void 0;const i=o(103),a=o(984);r.createCopyPromocodeBtn=(t,r,o,c)=>{const l=document.createElement("div");return l.classList.add(r+"-slide-product-price-promocode-copy"),l.appendChild((0,a.getCopyIconElement)()),l?.addEventListener("click",(async a=>{a.stopPropagation();try{await navigator.clipboard.writeText(o),(0,i.showNotification)(t,r,c)}catch(t){console.error(t)}})),l}},132:function(t,r,o){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,r,o,i){void 0===i&&(i=o);var a=Object.getOwnPropertyDescriptor(r,o);a&&!("get"in a?!r.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(t,i,a)}:function(t,r,o,i){void 0===i&&(i=o),t[i]=r[o]}),a=this&&this.__exportStar||function(t,r){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(r,o)||i(r,t,o)};Object.defineProperty(r,"__esModule",{value:!0}),a(o(60),r),a(o(103),r),a(o(34),r)},103:(t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.showNotification=void 0;r.showNotification=(t,r,o,i=2e3)=>{if(t.querySelector(`.${r}-slide-product-price-promocode-notification`))return;const a=document.createElement("div");a.classList.add(r+"-slide-product-price-promocode-notification"),a.innerText=o,t.appendChild(a);const c=a.getBoundingClientRect(),l=c.width,u=c.height;a.style.right=`calc(50% - ${l/2}px)`,a.style.top=`calc(-17px - ${u}px)`,setTimeout((()=>{t.removeChild(a)}),i)}},687:(t,r,o)=>{"use strict";o.r(r),o.d(r,{CART_METHOD:()=>i,EXPIRES_24H_SEC:()=>c,EXPIRES_5SEC_TEST:()=>l,LOCAL_STORAGE_EXPIRES_SUFFIX:()=>a,ONE_HOUR_IN_MILLISECONDS:()=>d,SEARCH_KEYS:()=>p.U,SESSION_CODE_EXPIRE:()=>u,__esModule:()=>!0});var i={GET:"get"},a="_expires",c=86400,l=5,u=2,d=36e5,p=o(931)},428:(t,r,o)=>{"use strict";o.r(r),o.d(r,{default:()=>a});var i=o(687);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _toPropertyKey(t){var r=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(r)?r:r+""}const a=function(){return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function CookieManager(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,CookieManager)}),null,[{key:"get",value:function get(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=localStorage.getItem(t),a=localStorage.getItem(t+i.LOCAL_STORAGE_EXPIRES_SUFFIX);if(o){if(a)if(new Date>new Date(a))return localStorage.removeItem(t),localStorage.removeItem(t+i.LOCAL_STORAGE_EXPIRES_SUFFIX),"";return o}if(r)return"";var c=document.cookie.match(RegExp("(?:^|; )".concat(t.replace(/([.$?*|{}()[]\\\/+^])/g,"\\$1"),"=([^;]*)")));return c?decodeURIComponent(c[1]):""}},{key:"set",value:function set(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{if(a&&r){if(this.get(t,!0)===r)return;localStorage.setItem(t,r);var c=o.expires||i.EXPIRES_24H_SEC,l=new Date;l.setTime(l.getTime()+1e3*c),localStorage.setItem(t+i.LOCAL_STORAGE_EXPIRES_SUFFIX,l.toISOString())}if(null!=a&&a.areCookiesForbidden())return;var u=(o=o||{}).expires;if("number"==typeof u&&u){var d=new Date;d.setTime(d.getTime()+1e3*u),u=o.expires=d}u&&u.toUTCString&&(o.expires=u.toUTCString()),r=encodeURIComponent(r);var p="".concat(t,"=").concat(r);for(var h in o){p+="; ".concat(h);var m=o[h];!0!==m&&(p+="=".concat(m))}document.cookie=p}catch(t){console.error("Storage is not allowed",t)}}},{key:"remove",value:function remove(t){localStorage.removeItem(t),document.cookie.includes(t)&&(document.cookie="".concat(t,"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"))}}])}()}},r={};function __webpack_require__(o){var i=r[o];if(void 0!==i)return i.exports;var a=r[o]={exports:{}};return t[o].call(a.exports,a,a.exports,__webpack_require__),a.exports}__webpack_require__.d=(t,r)=>{for(var o in r)__webpack_require__.o(r,o)&&!__webpack_require__.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{"use strict";__webpack_require__.r(o),__webpack_require__.d(o,{Core:()=>he});var t=__webpack_require__(687),r=__webpack_require__(428),i="data-min",a="data-max";function validateRange(t,r){return"number"==typeof t&&"number"==typeof r&&(!(t<0||r<0)&&!(t>r))}function createSliderThumb(t,r,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if("number"!=typeof t||"number"!=typeof i||t<r||t>o||!validateRange(r,o))return console.error("Invalid input: parameters must be numbers and within valid range"),null;var a=document.createElement("div");return a.classList.add("slider-thumb"),a.style.top="2px",a.style.left="calc(".concat((t-r)/(o-r)*100,"% - ").concat(i,"px)"),a}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _toPropertyKey(t){var r=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(r)?r:r+""}var c=function(){return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Slider(t){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Slider),this.core=t,this.label="".concat(t.label.fullName()).concat("-search"),this.range=null,this.rangeProgress=null,this.valueWrapper=null,this.minThumb=null,this.maxThumb=null,this.minValueDisplay=null,this.maxValueDisplay=null}),[{key:"createPriceSlider",value:function createPriceSlider(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,c=arguments.length>2?arguments[2]:void 0;if(r>o)return null;this.label="".concat(this.core.label.fullName(),"-search");var l=function createSliderBlock(t){if(!t||"string"!=typeof t)return console.error("Invalid input: label must be a string"),null;var r=document.createElement("div");return r.classList.add("".concat(t,"-search-price-slider")),r}(this.label);return this.range=function createRange(t,r,o){if(!validateRange(r,o))return console.error("Invalid price range values:",{minPrice:r,maxPrice:o}),{range:null,rangeProgress:null};var c=document.createElement("div");c.classList.add("".concat(t,"-range-slider")),c.setAttribute(i,"".concat(r)),c.setAttribute(a,"".concat(o));var l=document.createElement("div");return l.classList.add("".concat(t,"-range-progress")),c.appendChild(l),{range:c,rangeProgress:l}}(this.label,r,o),this.valueWrapper=function createValuesBlock(t,r,o){if("string"!=typeof t||!validateRange(r,o))return console.error("Invalid input: parameters must be strings and numbers within valid range"),{valueWrapper:null,minValueDisplay:null,maxValueDisplay:null};var i=document.createElement("div");i.classList.add("".concat(t,"-range-values"));var a=document.createElement("div");a.textContent="".concat(r);var c=document.createElement("div");return c.textContent="".concat(o),i.appendChild(a),i.appendChild(c),{valueWrapper:i,minValueDisplay:a,maxValueDisplay:c}}(this.label,r,o),l&&(l.appendChild(this.valueWrapper.valueWrapper),l.appendChild(this.range.range)),this.minThumb=createSliderThumb(r,r,o,0),this.maxThumb=createSliderThumb(o,r,o,16),this.range&&this.range.range&&(this.range.range.appendChild(this.minThumb),this.range.range.appendChild(this.maxThumb)),this.minThumb&&this.minThumb.addEventListener("mousedown",(function(r){return t._startDrag(r,"min",c)})),this.maxThumb&&this.maxThumb.addEventListener("mousedown",(function(r){return t._startDrag(r,"max",c)})),l}},{key:"_startDrag",value:function _startDrag(t,r,o){var c=this;t.preventDefault();var l="min"===r?this.minThumb:this.maxThumb,u=this.range.range,d=parseFloat(u.getAttribute(i)),p=parseFloat(u.getAttribute(a));(isNaN(d)||isNaN(p))&&(d=0,p=1e3);var h=t.clientX-l.getBoundingClientRect().left,m=u.clientWidth-l.clientWidth,y=function moveThumb(t){return c._moveThumb(t,l,h,u,d,p,m,r)},g=function stopDrag(){return c._stopDrag(m,d,p,o,y,g)};document.addEventListener("mousemove",y),document.addEventListener("mouseup",g)}},{key:"_moveThumb",value:function _moveThumb(t,r,o,i,a,c,l,u){var d=t.clientX-o-i.getBoundingClientRect().left;d<0&&(d=0),d>l&&(d=l);var p=a+d/l*(c-a);if("min"===u){this.minThumb.style.zIndex="2",this.maxThumb.style.zIndex="1";var h=parseFloat(this.maxThumb.style.left)/l*(c-a)+a;p>=h&&(d=(h-a)/(c-a)*l)}else{this.maxThumb.style.zIndex="2",this.minThumb.style.zIndex="1";var m=parseFloat(this.minThumb.style.left)/l*(c-a)+a;p<=m&&(d=(m-a)/(c-a)*l)}r.style.left="".concat(d,"px"),this._updateRangeProgress(a,c)}},{key:"_updateRangeProgress",value:function _updateRangeProgress(t,r){var o=this.range.range.clientWidth-this.minThumb.clientWidth,i=isNaN(parseFloat(this.minThumb.style.left))?0:parseFloat(this.minThumb.style.left),a=isNaN(parseFloat(this.maxThumb.style.left))?o:parseFloat(this.maxThumb.style.left),c=i/o*100,l=a/o*100;this.range.rangeProgress.style.left="".concat(c,"%"),this.range.rangeProgress.style.width="".concat(l-c,"%");var u=t+i/o*(r-t),d=t+a/o*(r-t);this.valueWrapper.minValueDisplay.textContent="".concat(Math.floor(u)),this.valueWrapper.maxValueDisplay.textContent="".concat(Math.floor(d))}},{key:"_stopDrag",value:function _stopDrag(t,r,o,i,a,c){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",c);var l=parseFloat(this.minThumb.style.left)/t*(o-r)+r||r,u=parseFloat(this.maxThumb.style.left)/t*(o-r)+r||o;i(Math.floor(l),Math.floor(u))}}])}();function _slicedToArray(t,r){return function _arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var i,a,c,l,u=[],d=!0,p=!1;try{if(c=(o=o.call(t)).next,0===r){if(Object(o)!==o)return;d=!1}else for(;!(d=(i=c.call(o)).done)&&(u.push(i.value),u.length!==r);d=!0);}catch(t){p=!0,a=t}finally{try{if(!d&&null!=o.return&&(l=o.return(),Object(l)!==l))return}finally{if(p)throw a}}return u}}(t,r)||function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,r):void 0}}(t,r)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,i=Array(r);o<r;o++)i[o]=t[o];return i}function createSortSelect(t,r){var o=document.createElement("div");o.classList.add("".concat(t,"-sort"));var i=document.createElement("select");return Object.entries(r).map((function(t,r){var o=_slicedToArray(t,2);return function createOption(t,r,o){var i=document.createElement("option");return i.setAttribute("value",t),i.appendChild(document.createTextNode(r)),i.selected=o,i}(o[0],o[1],0===r)})).forEach((function(t){return i.appendChild(t)})),o.appendChild(i),o}var l={popular:"Popular",price:"Price",discount:"Discount",sales_rate:"Sales",date:"Novelty"};function search_filters_typeof(t){return search_filters_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},search_filters_typeof(t)}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function search_filters_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return search_filters_arrayLikeToArray(t,r);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?search_filters_arrayLikeToArray(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var i=0,a=function F(){};return{s:a,n:function n(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,l=!0,u=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return l=t.done,t},e:function e(t){u=!0,c=t},f:function f(){try{l||null==o.return||o.return()}finally{if(u)throw c}}}}function search_filters_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,i=Array(r);o<r;o++)i[o]=t[o];return i}function search_filters_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,search_filters_toPropertyKey(i.key),i)}}function search_filters_toPropertyKey(t){var r=function search_filters_toPrimitive(t,r){if("object"!=search_filters_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=search_filters_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==search_filters_typeof(r)?r:r+""}var u=function(){return function search_filters_createClass(t,r,o){return r&&search_filters_defineProperties(t.prototype,r),o&&search_filters_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function SearchFilters(t,r,o,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};!function search_filters_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,SearchFilters),this.core=t,this.params=r,this.block=o,this.selected=a,this.categories_selected=r.categories?r.categories.split(","):[],this.brands_selected=r.brands?r.brands.split(","):[],this.url_params=new URLSearchParams(window.location.search),this.endpoint=i,this.sliderCreator=new c(this.core)}),[{key:"setCallback",value:function setCallback(t){this.callback=t}},{key:"setTotalResultSelector",value:function setTotalResultSelector(t){this.total=t}},{key:"setSortSelector",value:function setSortSelector(t){this.sort=t}},{key:"request",value:function request(){var t=this,r=Object.assign({},this.params);if(this.categories_selected=[],[].forEach.call(this.findRoot().querySelectorAll("#"+this.core.label.fullName()+"_search_categories input:checked"),(function(r){t.categories_selected.push(r.value)})),r.categories=this.categories_selected.join(","),this.url_params.set(this.core.label.fullName()+"_search_categories",r.categories),this.brands_selected=[],[].forEach.call(this.findRoot().querySelectorAll("#"+this.core.label.fullName()+"_search_brands input:checked"),(function(r){t.brands_selected.push(r.value)})),r.brands=this.brands_selected.join(","),this.url_params.set(this.core.label.fullName()+"_search_brands",r.brands),this.selected={},[].forEach.call(this.findRoot().querySelectorAll("#"+this.core.label.fullName()+"_search_filters input:checked"),(function(r){var o=r.parentElement.parentElement.getAttribute("data-name");t.selected[o]||(t.selected[o]=[]),t.selected[o].push(r.value)})),r.filters=JSON.stringify(this.selected),this.url_params.set(this.core.label.fullName()+"_search_filters",r.filters),this.sort){var o=document.querySelector(this.sort),i=document.querySelector(".".concat(this.core.label.fullName()+"-sort-order button"));r.sort_by=null==o?void 0:o.value,r.order=null==i?void 0:i.getAttribute("data-value"),this.url_params.set(this.core.label.fullName()+"_search_sort_by",r.sort_by),this.url_params.set(this.core.label.fullName()+"_search_order",r.order||"")}history.replaceState("","",window.location.pathname+"?"+this.url_params.toString()),this.core.ajax.sendGet(this.core.api.getAPIUrl(this.endpoint),r).then((function(r){t.callback(r),t.print(r)}))}},{key:"print",value:function print(t){var r,o,i=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var c in a&&(this.filters=t.filters||{},this.categories=t.categories||[],this.brands=t.brands||[],this.price_range=t.price_range,this.html(),this.sort&&he.addEvent(document.querySelector(this.sort),"change",this.request.bind(this))),this.filters)if(this.filters.hasOwnProperty(c))for(var l="#"+this.core.label.fullName()+'_search_filters > div[data-name="'+CSS.escape(c)+'"]',u=this.findRoot().querySelectorAll(l+" label"),d=t.filters[c]?new Set(Object.keys(t.filters[c].values)):new Set,p=!!this.selected[c],h=p?new Set(this.selected[c]):new Set,m=0;m<u.length;m++){var y=u[m],g=y.getAttribute("data-name"),b=y.querySelector("input");b.disabled=!d.has(g)&&!p,b.checked=h.has(g);var v=y.querySelector("div"),_=t.filters[c]&&t.filters[c].values[g]?t.filters[c].values[g]:"";null==v||v.setAttribute("data-sup",_)}var w=new Set(t.categories.map((function(t){return t.id}))),k=0===this.categories_selected.length;[].forEach.call(null===(r=this.findRoot())||void 0===r?void 0:r.querySelectorAll("#"+this.core.label.fullName()+"_search_categories label"),(function(t){var r=t.querySelector("input"),o=t.getAttribute("data-name");r.disabled=!w.has(o)&&k,r.checked=i.categories_selected.includes(o)}));var P=new Set(t.brands.map((function(t){return t.name.toLowerCase()}))),S=0===this.brands_selected.length;[].forEach.call(null===(o=this.findRoot())||void 0===o?void 0:o.querySelectorAll("#"+this.core.label.fullName()+"_search_brands label"),(function(t){var r=t.querySelector("input"),o=t.getAttribute("data-name");r.disabled=!P.has(o)&&S,r.checked=i.brands_selected.includes(o)})),this.total&&(document.querySelector(this.total).textContent=t.products_total)}},{key:"findRoot",value:function findRoot(){return document.querySelector(this.block)}},{key:"html",value:function html(){var t=this,r=this.findRoot();if(r){if(this.categories.length){this.core.logger.debug("Filters print "+this.categories.length+" categories"),r.appendChild(this._createElement("div",[this.core.label.fullName()+"-search-group-title",this.core.label.fullName()+"-search-group-title-categories"],r.getAttribute("data-categories-title")||this.core.search&&this.core.search.settings.categories_title||"Categories"));var o=document.createElement("div");o.id=this.core.label.fullName()+"_search_categories",r.appendChild(o);var i,a=_createForOfIteratorHelper(this.categories);try{for(a.s();!(i=a.n()).done;){var c=i.value,u=this._createCheckbox(c.id,c.name,c.count);he.addEvent(u.querySelector("input"),"change",this.request.bind(this)),o.appendChild(u)}}catch(t){a.e(t)}finally{a.f()}}if(this.brands.length){this.core.logger.debug("Filters print "+this.brands.length+" brands"),r.appendChild(this._createElement("div",[this.core.label.fullName()+"-search-group-title",this.core.label.fullName()+"-search-group-title-brands"],r.getAttribute("data-brands-title")||this.core.search&&this.core.search.settings.brands_title||"Brands"));var d=document.createElement("div");d.id=this.core.label.fullName()+"_search_brands",r.appendChild(d);var p,h=_createForOfIteratorHelper(this.brands);try{for(h.s();!(p=h.n()).done;){var m=p.value,y=this._createCheckbox(m.name.toLowerCase(),m.name);he.addEvent(y.querySelector("input"),"change",this.request.bind(this)),d.appendChild(y)}}catch(t){h.e(t)}finally{h.f()}}var g=this.price_range||{min:0,max:1e3},b=this.sliderCreator.createPriceSlider(Math.floor(g.min),Math.ceil(g.max),(function(r,o){t.params.price_min=r,t.params.price_max=o,t.request()}));"true"===r.getAttribute("data-search-with-price-slider")&&(r.appendChild(this._createElement("div",[this.core.label.fullName()+"-search-group-title",this.core.label.fullName()+"-search-group-title-price"],r.getAttribute("data-price-filter-title")||this.core.search&&this.core.search.settings.price_filter_name||"Price")),r.appendChild(b));var v=this.core.search.settings,_=v.sort_by_popular,w=v.sort_by_price,k=v.sort_by_discount,P=v.sort_by_sales_rate,S=v.sort_by_new,C=v.sort_dir_asc,x=v.sort_dir_desc;l.popular=_||l.popular,l.price=w||l.price,l.discount=k||l.discount,l.sales_rate=P||l.sales_rate,l.date=S||l.date;var E=createSortSelect(this.core.label.fullName(),l),A=function createSortOrder(t,r,o,i){var a=document.createElement("div");a.classList.add("".concat(t,"-sort-order"));var c=document.createElement("button");return c.setAttribute("data-value","desc"),c.setAttribute("data-asc-name",r),c.setAttribute("data-desc-name",o),c.textContent=o,c.addEventListener("click",(function(){var t=c.getAttribute("data-value");c.setAttribute("data-value","asc"===t?"desc":"asc"),c.textContent="asc"===t?o:r,null==i||i()})),a.appendChild(c),a}(this.core.label.fullName(),C,x,this.request.bind(this));if("true"===r.getAttribute("data-search-with-sort")&&(r.appendChild(this._createElement("div",[this.core.label.fullName()+"-search-group-title",this.core.label.fullName()+"-search-group-title-sort"],r.getAttribute("data-sort-title")||this.core.search&&this.core.search.settings.sort_by_name||"Sort")),r.appendChild(A),r.appendChild(E)),Object.keys(this.filters).length){this.core.logger.debug("Filters print "+Object.keys(this.filters).length+" filters"),r.appendChild(this._createElement("div",[this.core.label.fullName()+"-search-group-title",this.core.label.fullName()+"-search-group-title-filters"],r.getAttribute("data-filters-title")||this.core.search&&this.core.search.settings.filters_title||"Filters"));var T=document.createElement("div");for(var j in T.id=this.core.label.fullName()+"_search_filters",r.appendChild(T),this.filters)this.filters.hasOwnProperty(j)&&T.appendChild(this._createFilter(j,this.filters[j]))}this.core.logger.debug("Filters block html: "+r.innerHTML)}else this.core.logger.warn("Filter block "+this.block+" not found")}},{key:"_createElement",value:function _createElement(t,r,o){var i=document.createElement(t);return r&&(Array.isArray(r)?r.forEach((function(t){return i.classList.add(t)})):i.classList.add(r)),i.textContent=o,i}},{key:"_createCheckbox",value:function _createCheckbox(t,r,o){var i=document.createElement("label");i.classList.add(this.core.label.fullName()+"-search__checkbox"),i.setAttribute("data-name",t);var a=document.createElement("input");a.setAttribute("type","checkbox"),a.value=t,i.appendChild(a),i.appendChild(document.createElement("span"));var c=this._createElement("div",null,r||t);return c.setAttribute("data-sup",o||""),i.appendChild(c),i}},{key:"_createFilter",value:function _createFilter(t,r){var o=document.createElement("div");for(var i in o.setAttribute("data-name",t),o.appendChild(this._createElement("div",this.core.label.fullName()+"-search-filter",t)),r.values){var a=this._createCheckbox(i,null,r.values[i]);he.addEvent(a.querySelector("input"),"change",this.request.bind(this)),o.appendChild(a)}return o}}])}();const d=u;function _regeneratorRuntime(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function _regeneratorRuntime(){return r};var t,r={},o=Object.prototype,i=o.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",d=c.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,l=Object.create(c.prototype),u=new Context(i||[]);return a(l,"_invoke",{value:makeInvokeMethod(t,o,u)}),l}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}r.wrap=wrap;var p="suspendedStart",h="suspendedYield",m="executing",y="completed",g={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var b={};define(b,l,(function(){return this}));var v=Object.getPrototypeOf,_=v&&v(v(values([])));_&&_!==o&&i.call(_,l)&&(b=_);var w=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(b);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,a,c,l){var u=tryCatch(t[o],t,a);if("throw"!==u.type){var d=u.arg,p=d.value;return p&&"object"==recommender_typeof(p)&&i.call(p,"__await")?r.resolve(p.__await).then((function(t){invoke("next",t,c,l)}),(function(t){invoke("throw",t,c,l)})):r.resolve(p).then((function(t){d.value=t,c(d)}),(function(t){return invoke("throw",t,c,l)}))}l(u.arg)}var o;a(this,"_invoke",{value:function value(t,i){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,i,r,o)}))}return o=o?o.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(r,o,i){var a=p;return function(c,l){if(a===m)throw Error("Generator is already running");if(a===y){if("throw"===c)throw l;return{value:t,done:!0}}for(i.method=c,i.arg=l;;){var u=i.delegate;if(u){var d=maybeInvokeDelegate(u,i);if(d){if(d===g)continue;return d}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===p)throw a=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=m;var b=tryCatch(r,o,i);if("normal"===b.type){if(a=i.done?y:h,b.arg===g)continue;return{value:b.arg,done:i.done}}"throw"===b.type&&(a=y,i.method="throw",i.arg=b.arg)}}}function maybeInvokeDelegate(r,o){var i=o.method,a=r.iterator[i];if(a===t)return o.delegate=null,"throw"===i&&r.iterator.return&&(o.method="return",o.arg=t,maybeInvokeDelegate(r,o),"throw"===o.method)||"return"!==i&&(o.method="throw",o.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var c=tryCatch(a,r.iterator,o.arg);if("throw"===c.type)return o.method="throw",o.arg=c.arg,o.delegate=null,g;var l=c.arg;return l?l.done?(o[r.resultName]=l.value,o.next=r.nextLoc,"return"!==o.method&&(o.method="next",o.arg=t),o.delegate=null,g):l:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,g)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(r){if(r||""===r){var o=r[l];if(o)return o.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var a=-1,c=function next(){for(;++a<r.length;)if(i.call(r,a))return next.value=r[a],next.done=!1,next;return next.value=t,next.done=!0,next};return c.next=c}}throw new TypeError(recommender_typeof(r)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(w,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,d,"GeneratorFunction"),r.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,d,"GeneratorFunction")),t.prototype=Object.create(w),t},r.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),r.AsyncIterator=AsyncIterator,r.async=function(t,o,i,a,c){void 0===c&&(c=Promise);var l=new AsyncIterator(wrap(t,o,i,a),c);return r.isGeneratorFunction(o)?l:l.next().then((function(t){return t.done?t.value:l.next()}))},defineIteratorMethods(w),define(w,d,"Generator"),define(w,l,(function(){return this})),define(w,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var r=Object(t),o=[];for(var i in r)o.push(i);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},r.values=values,Context.prototype={constructor:Context,reset:function reset(r){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!r)for(var o in this)"t"===o.charAt(0)&&i.call(this,o)&&!isNaN(+o.slice(1))&&(this[o]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(r){if(this.done)throw r;var o=this;function handle(i,a){return l.type="throw",l.arg=r,o.next=i,a&&(o.method="next",o.arg=t),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],l=c.completion;if("root"===c.tryLoc)return handle("end");if(c.tryLoc<=this.prev){var u=i.call(c,"catchLoc"),d=i.call(c,"finallyLoc");if(u&&d){if(this.prev<c.catchLoc)return handle(c.catchLoc,!0);if(this.prev<c.finallyLoc)return handle(c.finallyLoc)}else if(u){if(this.prev<c.catchLoc)return handle(c.catchLoc,!0)}else{if(!d)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return handle(c.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var c=a;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var l=c?c.completion:{};return l.type=t,l.arg=r,c?(this.method="next",this.next=c.finallyLoc,g):this.complete(l)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),g},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),g}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var i=o.completion;if("throw"===i.type){var a=i.arg;resetTryEntry(o)}return a}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(r,o,i){return this.delegate={iterator:values(r),resultName:o,nextLoc:i},"next"===this.method&&(this.arg=t),g}},r}function recommender_slicedToArray(t,r){return function recommender_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function recommender_iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var i,a,c,l,u=[],d=!0,p=!1;try{if(c=(o=o.call(t)).next,0===r){if(Object(o)!==o)return;d=!1}else for(;!(d=(i=c.call(o)).done)&&(u.push(i.value),u.length!==r);d=!0);}catch(t){p=!0,a=t}finally{try{if(!d&&null!=o.return&&(l=o.return(),Object(l)!==l))return}finally{if(p)throw a}}return u}}(t,r)||function recommender_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return recommender_arrayLikeToArray(t,r);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?recommender_arrayLikeToArray(t,r):void 0}}(t,r)||function recommender_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function recommender_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,i=Array(r);o<r;o++)i[o]=t[o];return i}function asyncGeneratorStep(t,r,o,i,a,c,l){try{var u=t[c](l),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(i,a)}function recommender_typeof(t){return recommender_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},recommender_typeof(t)}function recommender_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,recommender_toPropertyKey(i.key),i)}}function recommender_toPropertyKey(t){var r=function recommender_toPrimitive(t,r){if("object"!=recommender_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=recommender_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==recommender_typeof(r)?r:r+""}function _asyncIterator(t){var r,o,i,a=2;for("undefined"!=typeof Symbol&&(o=Symbol.asyncIterator,i=Symbol.iterator);a--;){if(o&&null!=(r=t[o]))return r.call(t);if(i&&null!=(r=t[i]))return new AsyncFromSyncIterator(r.call(t));o="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator(t){function AsyncFromSyncIteratorContinuation(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var r=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:r}}))}return AsyncFromSyncIterator=function AsyncFromSyncIterator(t){this.s=t,this.n=t.next},AsyncFromSyncIterator.prototype={s:null,n:null,next:function next(){return AsyncFromSyncIteratorContinuation(this.n.apply(this.s,arguments))},return:function _return(t){var r=this.s.return;return void 0===r?Promise.resolve({value:t,done:!0}):AsyncFromSyncIteratorContinuation(r.apply(this.s,arguments))},throw:function _throw(t){var r=this.s.return;return void 0===r?Promise.reject(t):AsyncFromSyncIteratorContinuation(r.apply(this.s,arguments))}},new AsyncFromSyncIterator(t)}var p=function(){function Recommender(t){!function recommender_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Recommender),function _defineProperty(t,r,o){return(r=recommender_toPropertyKey(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}(this,"params",void 0),this.core=t}return function recommender_createClass(t,r,o){return r&&recommender_defineProperties(t.prototype,r),o&&recommender_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(Recommender,[{key:"get",value:function get(t,r,o,i){if(!this.core.shop.recommendations)return"recommendations disabled";this.type="dynamic",this.params=r||{},this.code=t,this.code&&(this.code=this.code.toLowerCase()),this.success=o,this.failure=i,this.validate();var a={shop_id:this.core.shop.token,did:this.core.user.did,sid:this.core.user.seance,seance:this.core.user.seance};a.segment=this.core.segment,this.params.price_sensitive&&(a.price_sensitive=this.params.price_sensitive),this.params.cart&&(a["cart_item_id[]"]=[],this.params.cart.forEach((function(t){a["cart_item_id[]"].push(t)}))),this.params.locations&&(a.locations=this.params.locations.join(",")),this.params.extended&&(a.extended=1,this.params.with_locations&&(a.with_locations=this.params.with_locations)),this.params.discount&&(a.discount=1),this.params.search_query&&(a.search_query=this.params.search_query),this.params.category&&(a.category=this.params.category),this.params.categories&&(a.categories=this.params.categories.join(",")),this.params.exclude&&(a.exclude=this.params.exclude.join(",")),this.params.item&&(a.item_id=this.params.item),this.params.limit&&(a.limit=this.params.limit),this.params.brands&&(a.brands=this.params.brands.join(",")),this.params.exclude_brands&&(a.exclude_brands=this.params.exclude_brands.join(",")),this.params.items&&(a.items=this.params.items.join(",")),this.params.prevent_shuffle&&(a.prevent_shuffle=1),this.params.page&&this.params.page>1&&(a.page=this.params.page),this.core.ajax.sendGet(this.core.api.getAPIUrl((this.core.testRecommenderMode?"/test":"")+"/recommend/"+this.code),a).then(o).catch((function(t){if(!i)throw Error(t);i(t)}))}},{key:"validate",value:function validate(){if(!Recommender.isTypeValid(this.type))throw Error('Recommender: invalid type "'.concat(this.type,'"'));if("dynamic"===this.type&&!this.code)throw Error("Recommender: invalid code of block");if(void 0===this.params||null===this.params)throw Error("Recommender: params not set");if("function"!=typeof this.success)throw Error('Recommender: success callback must be function, got "'.concat(recommender_typeof(this.success),'"'));if(this.failure&&"function"!=typeof this.failure)throw Error('Recommender: failure callback must be function or undefined, got "'.concat(recommender_typeof(this.failure),'"'));if(this.params.cart){if(!(this.params.cart instanceof Array))throw Error("Recommender: incorrect cart syntax, must be array");0===this.params.cart.length&&(this.params.cart=null)}if(this.params.locations){if(!(this.params.locations instanceof Array))throw Error("Recommender: incorrect locations syntax, must be array");0===this.params.locations.length&&(this.params.locations=null)}if(this.params.categories){if(!(this.params.categories instanceof Array))throw Error("Recommender: incorrect categories syntax, must be array");0===this.params.categories.length&&(this.params.categories=null)}if(this.params.brands){if(!(this.params.brands instanceof Array))throw Error("Recommender: incorrect brands syntax, must be array");0===this.params.brands.length&&(this.params.brands=null)}if(this.params.exclude_brands){if(!(this.params.exclude_brands instanceof Array))throw Error("Recommender: incorrect exclude_brands syntax, must be array");0===this.params.exclude_brands.length&&(this.params.exclude_brands=null)}switch(this.type){case"search":if(!this.params.search_query)throw Error("Recommender: search query is not set for search recommender");break;case"see_also":if(!this.params.cart)throw Error('Recommender: cart is empty, recommender "see_also" doesn\'t work without cart')}return!0}}],[{key:"isTypeValid",value:function isTypeValid(t){return Recommender.getTypes().indexOf(t)>=0}},{key:"getTypes",value:function getTypes(){return["banner","dynamic","instant_search","full_search","reputation","popup","stories","listing","bulk","chain"]}},{key:"initDynamic",value:function initDynamic(t){if(t.shop.token&&t.user.did&&t.shop.recommendations){var r=!1,o=null,i=function requestRecommender(r){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!o||!r.classList.contains(t.label.fullName()+"-recommend-rendered")&&i.intersectionRatio&&0!==i.intersectionRatio){r.classList.add(t.label.fullName()+"-recommend-rendered");var u={};["code","item","category","search_query","for_user","min","limit","page"].forEach((function(t){var o=r.getAttribute("data-recommender-"+t);o&&(u[t]=o.replace(/^\s+|\s+$/g,""),"code"===t&&(u[t]=u[t].toLowerCase()))})),["brands","categories","exclude","locations","items"].forEach((function(t){var o=r.getAttribute("data-recommender-"+t);o&&(u[t]=o.split(/,/).reduce((function(t,r){return r.length>0&&t.push(r.trim()),t}),[]))}));var d=function renderDiv(r,o){if(void 0!==o.html)r.innerHTML=o.html;else{if("paused"===o.state)return;t.logger.error("Recommender template can not be blank for: "+r.getAttribute("data-recommender-code"))}var i=r.getAttribute("data-recommender-callback");i&&(void 0===window[i]?console.error("Global function "+i+" is not defined"):window[i](r,o)),o.snippet&&Function(o.snippet)(r,o)};++a>=l&&(c++,a=0),setTimeout((function(){new Recommender(t).get(u.code,u,(function(o){if(o.recommends&&u.min&&o.recommends.length<u.min)t.logger.debug("There are fewer products in the API response than necessary. Necessary: ".concat(u.min,", the API response: ").concat(o.recommends.length));else if(document.contains(r))d(r,o);else{t.logger.debug("Trying to find the block again by its code if its pointer was lost.");var i=r.getAttribute("data-recommender-code");i&&[].forEach.call(document.querySelectorAll("."+t.label.fullName()+'-recommend[data-recommender-code="'.concat(i,'"]')),(function(t){d(t,o)}))}}),(function(){var t=r.getAttribute("data-recommender-error");document.contains(r)&&t&&(void 0===window[t]?console.error("Global function "+t+" is not defined"):window[t](r))}))}),o?0:200*c)}};if(t.shop.recommendersLazyLoad&&!t.isSafari()&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){r=!0;o=new IntersectionObserver((function callback(t){t.forEach((function(t){return t.target&&i(t.target,r,t)}))}),{root:null})}var a=0,c=0,l=5;Array.from(document.querySelectorAll("."+t.label.fullName()+'-recommend[data-recommender-block="dynamic"]:not(.'+t.label.fullName()+"-recommend-rendered)")).sort((function(t,r){var o=getComputedStyle(t),i=getComputedStyle(r);return(null!==r.offsetParent&&"none"!==i.display&&"hidden"!==i.visible)-(null!==t.offsetParent&&"none"!==o.display&&"hidden"!==o.visible)})).forEach((function(t){var a;!r||t.dataset.recommenderLazy&&"false"===t.dataset.recommenderLazy.toLowerCase()?i(t,!1):null===(a=o)||void 0===a||a.observe(t)}))}}},{key:"initCategory",value:function initCategory(t){var r=".".concat(t.label.fullName(),"-category-results:not(.").concat(t.label.fullName(),"-category-results-rendered)"),o=document.querySelectorAll(r);o.length<1||this.isCoreValid(t)&&(t.addStyleToPage("search_css"),o.forEach((function(r,o){r.classList.add("".concat(t.label.fullName(),"-category-results-rendered"));var i,a=r.getAttribute("data-category");if(a){var c={shop_id:t.shop.token,did:t.user.did,sid:t.user.seance,seance:t.user.seance};["limit","page","offset","available","sort-by","order","filters","locations","price-min","price-max","brands"].forEach((function(t){var o=r.getAttribute("data-category-".concat(t));o&&(c[t.replace("-","_")]=o.replace(/^\s+|\s+$/g,""))}));var l=r.getAttribute("data-category-filters-block");if(l&&document.querySelector(l)){var u={};try{u=JSON.parse(r.getAttribute("data-category-filters")||"{}")}catch(r){t.logger.error(r)}i=new d(t,c,l,"/category/".concat(a),u);var p=r.getAttribute("data-category-total-block");i.setTotalResultSelector(p);var h=r.getAttribute("data-category-sort-block");i.setSortSelector(h)}else{var m=r.getAttribute("data-category-filters-block");t.logger.debug("Category filter block: ".concat(m,", found: ").concat(!!document.querySelector(null!=m?m:".")))}var y=function renderSearchDiv(r,o){var a=function attachResult(o){void 0!==o.html?r.innerHTML=o.html:t.logger.error("Category template is missing."),void 0!==o.products_total&&r.setAttribute("data-category-response-total",o.products_total);var i=r.getAttribute("data-category-callback");i&&(void 0===window[i]?t.logger.error("Global function ".concat(i," is not defined")):window[i](r,o))};if(t.logger.debug("Category attach results"),a(o),t.logger.debug("Category filters object: ".concat(i)),i){i.setCallback(a);try{i.print(o,!0)}catch(r){t.logger.error(r)}}};t.logger.debug("Category request with data ".concat(JSON.stringify(c))),t.ajax.sendGet(t.api.getAPIUrl("/category/".concat(a)),c).then((function(i){if(document.contains(r))y(r,i);else{t.logger.debug("Trying to find the category block again by its index if its pointer was lost.");var a=document.querySelectorAll("."+t.label.fullName()+"-category-results");void 0!==o&&void 0!==a[o]&&y(a[o],i)}})).catch((function(){var o=r.getAttribute("data-category-error");o&&(void 0===window[o]?t.logger.error("Global function ".concat(o," is not defined")):window[o](r))}))}else t.logger.error("Category can not be blank for div implementation")})))}},{key:"initProducts",value:(t=function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(i,a){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,i,a,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,i,a,_next,_throw,"throw",t)}_next(void 0)}))}}(_regeneratorRuntime().mark((function _callee(t){var r,o,i,a,c,l,u,p,h,m;return _regeneratorRuntime().wrap((function _callee$(y){for(;;)switch(y.prev=y.next){case 0:if(r=t.label.fullName(),o=".".concat(r,"-products-results:not(.").concat(r,"-products-results-rendered)"),!((i=document.querySelectorAll(o)).length<1)){y.next=5;break}return y.abrupt("return");case 5:if(this.isCoreValid(t)){y.next=7;break}return y.abrupt("return");case 7:t.addStyleToPage("search_css"),a=!1,c=!1,y.prev=10,u=_regeneratorRuntime().mark((function _loop(){var o,i,a,c,l,u,p,h,y,g,b,v,_,w,k,P,S;return _regeneratorRuntime().wrap((function _loop$(C){for(;;)switch(C.prev=C.next){case 0:if(o=recommender_slicedToArray(m.value,2),i=o[0],(a=o[1]).classList.add("".concat(r,"-products-results-rendered")),l=["categories","limit","merchants","page","offset","available","sort-by","order","filters","locations","price-min","price-max","brands","filters-search-by"],u={shop_id:t.shop.token,did:t.user.did,sid:t.user.seance},l.forEach((function(t){var r=a.getAttribute("data-products-".concat(t));r&&(u[t.replace("-","_")]=r.replace(/^\s+|\s+$/g,""))})),(p=a.getAttribute("data-products-filters-block"))&&document.querySelector(p)){h={};try{h=JSON.parse(a.getAttribute("data-products-filters")||"{}")}catch(r){t.logger.error(r)}c=new d(t,u,p,"/products",h),y=a.getAttribute("data-products-total-block"),c.setTotalResultSelector(y),g=a.getAttribute("data-products-sort-block"),c.setSortSelector(g)}else b=a.getAttribute("data-products-filters-block"),t.logger.debug("Products filter block: ".concat(b,", found: ").concat(!!document.querySelector(null!=b?b:".")));return v=function renderSearchDiv(r,o){var i=function attachResult(o){void 0!==o.html?r.innerHTML=o.html:t.logger.error("Category template is missing."),void 0!==o.products_total&&r.setAttribute("data-products-response-total",o.products_total);var i=r.getAttribute("data-products-callback");i&&(void 0===window[i]?t.logger.error("Global function ".concat(i," is not defined")):window[i](r,o))};if(t.logger.debug("Category attach results"),i(o),t.logger.debug("Category filters object: ".concat(c)),c){c.setCallback(i);try{c.print(o,!0)}catch(r){t.logger.error(r)}}},t.logger.debug("Category request with data ".concat(JSON.stringify(u))),C.prev=9,C.next=12,t.ajax.sendGet(t.api.getAPIUrl("/products"),u);case 12:if(_=C.sent,!document.contains(a)){C.next=16;break}return v(a,_),C.abrupt("return",{v:void 0});case 16:t.logger.debug("Trying to find the category block again by its index if its pointer was lost."),w=document.querySelectorAll(".".concat(r,"-products-results")),k=void 0!==i,P=void 0!==w[i],k&&P&&v(w[i],_),C.next=31;break;case 23:if(C.prev=23,C.t0=C.catch(9),!(S=a.getAttribute("data-products-error"))){C.next=31;break}if(void 0!==window[S]){C.next=30;break}return t.logger.error("Global function ".concat(S," is not defined")),C.abrupt("return",{v:void 0});case 30:window[S](a);case 31:case"end":return C.stop()}}),_loop,null,[[9,23]])})),h=_asyncIterator(i.entries());case 13:return y.next=15,h.next();case 15:if(!(a=!(m=y.sent).done)){y.next=23;break}return y.delegateYield(u(),"t0",17);case 17:if(!(p=y.t0)){y.next=20;break}return y.abrupt("return",p.v);case 20:a=!1,y.next=13;break;case 23:y.next=29;break;case 25:y.prev=25,y.t1=y.catch(10),c=!0,l=y.t1;case 29:if(y.prev=29,y.prev=30,!a||null==h.return){y.next=34;break}return y.next=34,h.return();case 34:if(y.prev=34,!c){y.next=37;break}throw l;case 37:return y.finish(34);case 38:return y.finish(29);case 39:case"end":return y.stop()}}),_callee,this,[[10,25,29,39],[30,,34,38]])}))),function initProducts(r){return t.apply(this,arguments)})},{key:"isCoreValid",value:function isCoreValid(t){var r,o,i,a=!0;return null!==(r=t.shop)&&void 0!==r&&r.token||(t.logger.error("Shop token is empty"),a=!1),null!==(o=t.user)&&void 0!==o&&o.did||(t.logger.error("User device ID (did) is empty"),a=!1),null!==(i=t.shop)&&void 0!==i&&i.recommendations||(t.logger.error("Shop recommendations disabled"),a=!1),a}}]);var t}();const h=p;function profile_typeof(t){return profile_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},profile_typeof(t)}function profile_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,profile_toPropertyKey(i.key),i)}}function profile_toPropertyKey(t){var r=function profile_toPrimitive(t,r){if("object"!=profile_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=profile_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==profile_typeof(r)?r:r+""}var m=function(){return function profile_createClass(t,r,o){return r&&profile_defineProperties(t.prototype,r),o&&profile_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Profile(){!function profile_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Profile)}),null,[{key:"set",value:function set(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if("object"===profile_typeof(r)&&!he.isBot(t)){var a=r;r.hasOwnProperty("location")&&(t.user.location=r.location),r.hasOwnProperty("birthday")&&!r.birthday.match(/^\d{4}-\d{2}-\d{2}$/)&&delete a.birthday,Object.keys(a).length>0&&(a.shop_id=t.shop.token,a.sid=t.user.seance,a.seance=t.user.seance,a.did=t.user.did,t.ajax.sendPost(t.api.getAPIUrl("/profile/set"),a).then(o).catch((function(t){if(!i)throw Error(t);i(t)})))}}},{key:"get",value:function get(t,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("function"!=typeof r)throw Error("Incorrect callback function");t.user.profile&&!o?r(t.user.profile):t.ajax.sendGet(t.api.getAPIUrl("/profile"),{did:t.user.did,shop_id:t.shop.token}).then((function(o){t.user.profile=o,r(o)}))}}])}();const y=m;function popup_new_typeof(t){return popup_new_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},popup_new_typeof(t)}function popup_new_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,popup_new_toPropertyKey(i.key),i)}}function popup_new_toPropertyKey(t){var r=function popup_new_toPrimitive(t,r){if("object"!=popup_new_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=popup_new_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==popup_new_typeof(r)?r:r+""}var g=function(){function PopupNew(t,o){var i=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!function popup_new_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,PopupNew),this.core=t,this.data=o,this.manual=a;var c=PopupNew.popupName(o.id);if(this.name=c,this.addStyleToPage(o.id),0===o.channels.length||1===o.channels.length&&("web_push"===o.channels[0]&&t.web_push&&t.web_push.supported()||"web_push"!==o.channels[0])||o.channels.length>1)if(document.body.insertAdjacentElement)try{setTimeout((function(){if("showed"!==r.default.get(i.core.label.name()+"-popup-"+o.id,i.core.areCookiesForbidden())||i.manual){if(1===o.channels.length&&"web_push"===o.channels[0]&&parseInt(o.web_push_system))i.subscribe();else{if(document.getElementById(c))return void i.core.logger.debug("Popup "+c+" already showed");i.dialog=document.createElement("div"),i.dialog.id=c,i.dialog.innerHTML=o.html,document.body.insertAdjacentElement("beforeEnd",i.dialog),"top"===o.position&&i.dialog.childNodes[0].classList.add("".concat(c,"_top")),-1!==["slide_right","slide_left","fixed_bottom"].indexOf(o.position)&&(i.dialog.childNodes[0].classList.add("".concat(c,"_bottom")),"slide_right"===o.position&&i.dialog.childNodes[0].classList.add("".concat(c,"_right")),"slide_left"===o.position&&i.dialog.childNodes[0].classList.add("".concat(c,"_left"))),i.modal=document.getElementById("".concat(c,"-modal")),i.closeButton=document.getElementById("".concat(c,"-close")),i.form=document.getElementById("".concat(c,"-form")),i.submitButton=document.getElementById("".concat(c,"-submit")),i.select=document.getElementById("".concat(c,"-subscription-type")),i.email=document.getElementById("".concat(c,"-email")),i.dialog.onclick=i.close.bind(i),i.modal.onclick=function(t){t.stopPropagation()},i.closeButton.onclick=i.close.bind(i);var t=function keydown(r){27===(r=r||window.event).keyCode&&(i.close(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t),i.submitButton&&(i.submitButton.onclick=i.submit.bind(i)),i.form&&(i.form.onsubmit=i.submit.bind(i)),i.select&&i.email&&he.addEvent(i.select,"change",(function(t){i.email.classList.toggle("".concat(c,"__hidden"),"web_push"===i.select.value)}))}i.showed();var a=i.core.label.name()+"_popup_callback";"function"==typeof window[a]&&window[a](i.dialog)}}),1e3*o.delay)}catch(t){this.core.logger.error(t.message+": "+t.stack,this)}else this.core.logger.error("Old browser");else this.core.logger.error("Web push subscription is not supported in the current browser. Please use a modern browser that supports web push notifications.")}return function popup_new_createClass(t,r,o){return r&&popup_new_defineProperties(t.prototype,r),o&&popup_new_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(PopupNew,[{key:"close",value:function close(){var t=this;clearTimeout(this.closeTimer),this.dialog.className=this.dialog.className+" ".concat(this.name,"_removed"),setTimeout((function(){t.dialog.parentNode.removeChild(t.dialog)}),300)}},{key:"submit",value:function submit(t){t.preventDefault(),t.stopPropagation(),(this.select&&(-1!==["all","email"].indexOf(this.select.value)&&this.formValid(t)||-1===["all","email"].indexOf(this.select.value))||!this.select&&("web_push"===this.data.channels[0]||"email"===this.data.channels[0]&&this.formValid(t)))&&this.submitSuccess()}},{key:"submitSuccess",value:function submitSuccess(){this.dialog.firstChild.classList.add("".concat(this.name,"_successfully"));var t=this.data.channels;this.data.channels.length>1&&(t=this.select&&"all"!==this.select.value?[this.select.value]:this.data.channels),this.subscribe(t)}},{key:"subscribe",value:function subscribe(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o={popup:this.data.id};if(this.email&&(o.email=this.email.value),!this.data.web_push_system)for(var i=0,a=["first_name","last_name","phone","email","birthday"];i<a.length;i++){var c=a[i],l=this.dialog.querySelector('input[name="'+c+'"]');l&&l.value&&(o[c]=l.value.substr(0,250))}null!==r&&-1===r.indexOf("web_push")||!this.core.web_push?y.set(this.core,o):this.core.web_push.subscribe(!0,!0).then((function(r){r&&y.set(t.core,Object.assign(o,{web_push_token:r}),(function(){return t.core.logger.debug("The user has successfully subscribed.",t)}))})).catch((function(r){y.set(t.core,o),t.core.logger.error("The user has rejected the web push subscription request or is using a browser mode in which subscription isn't possible (incognito, private, etc). Error: "+r,t)}))}},{key:"formValid",value:function formValid(t){var r=this.form.querySelector("input:invalid");return r?(r.focus(),!1):this.form.checkValidity()}},{key:"showed",value:function showed(){var t={shop_id:this.core.shop.token,did:this.core.user.did,sid:this.core.user.seance,popup:this.data.id};this.core.ajax.sendWithRetry("post",this.core.api.getAPIUrl("/popup/showed"),t),"true"!==r.default.get(this.core.label.name()+"_testmode",this.core.areCookiesForbidden())&&r.default.set(this.core.label.name()+"-popup-"+this.data.id,"showed",{expires:60,path:"/"},this.core)}},{key:"addStyleToPage",value:function addStyleToPage(t){var r="".concat(this.core.label.fullName(),"-popup-css-").concat(t);if(!document.getElementById(r)){var o=document.createElement("link");o.setAttribute("id",r),o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href","//".concat(this.core.api.getMasterHost(),"/popup_css/").concat(this.core.shop.token,"_popup_").concat(t,".css")),document.getElementsByTagName("head")[0].appendChild(o)}}}],[{key:"prepare",value:function prepare(t,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r.id&&r.html&&!document.getElementById(this.popupName(r.id))&&new PopupNew(t,r,o)}},{key:"popupName",value:function popupName(t){return"popup-"+t}}])}();const b=g;function tracker_typeof(t){return tracker_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tracker_typeof(t)}function tracker_slicedToArray(t,r){return function tracker_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function tracker_iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var i,a,c,l,u=[],d=!0,p=!1;try{if(c=(o=o.call(t)).next,0===r){if(Object(o)!==o)return;d=!1}else for(;!(d=(i=c.call(o)).done)&&(u.push(i.value),u.length!==r);d=!0);}catch(t){p=!0,a=t}finally{try{if(!d&&null!=o.return&&(l=o.return(),Object(l)!==l))return}finally{if(p)throw a}}return u}}(t,r)||function tracker_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return tracker_arrayLikeToArray(t,r);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?tracker_arrayLikeToArray(t,r):void 0}}(t,r)||function tracker_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tracker_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,i=Array(r);o<r;o++)i[o]=t[o];return i}function tracker_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,tracker_toPropertyKey(i.key),i)}}function tracker_toPropertyKey(t){var r=function tracker_toPrimitive(t,r){if("object"!=tracker_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=tracker_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==tracker_typeof(r)?r:r+""}var v=function(){return function tracker_createClass(t,r,o){return r&&tracker_defineProperties(t.prototype,r),o&&tracker_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Tracker(t,r,o,i){if(function tracker_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Tracker),this.core=t,this.success=i,!o)throw Error("Track: empty data for track event");switch(this.queryParams={event:r,shop_id:this.core.shop.token,did:this.core.user.did,sid:this.core.user.seance,seance:this.core.user.seance,segment:this.core.segment},r){case"view":if(this.buildParams(o),o.recommended_by&&(this.queryParams.recommended_by=o.recommended_by,!h.isTypeValid(o.recommended_by)))throw Error('Push: invalid type "'.concat(o.recommended_by,'"'));o.recommended_code&&(this.queryParams.recommended_code=o.recommended_code);break;case"category":this.queryParams.category_id=o;break;case"wish":o instanceof Array?(o.forEach(this.buildParams.bind(this)),this.queryParams.full_wish=!0):this.buildParams(o);break;case"remove_wish":case"remove_from_cart":this.buildParams(o);break;case"cart":o instanceof Array?((o=Object.entries(o.reduce((function(t,r){return r.id&&(r.amount=Number(r.amount)||1)&&(t[r.id]?t[r.id]+=r.amount:t[r.id]=r.amount),t}),{})).map((function(t){var r=tracker_slicedToArray(t,2);return{id:r[0],amount:r[1]}}))).forEach(this.buildParams.bind(this)),this.queryParams.full_cart=!0):(o.recommended_by&&(this.queryParams.recommended_by=o.recommended_by),o.recommended_code&&(this.queryParams.recommended_code=o.recommended_code),this.buildParams(o));break;case"purchase":o.search_segment&&(this.queryParams.segment_ab=o.search_segment),o.order&&(this.queryParams.order_id=o.order),o.email&&(this.queryParams.email=o.email),o.phone&&(this.queryParams.phone=o.phone);for(var a=0,c=["order_price","order_cash","order_bonuses","order_delivery","order_discount","promocode","delivery_type","payment_type","tax_free","delivery_address"];a<c.length;a++){var l=c[a];o[l]&&(this.queryParams[l]=o[l])}if("object"===tracker_typeof(o.custom)&&null!==o.custom&&!Array.isArray(o.custom)&&Object.keys(o.custom).length>0&&(this.queryParams.custom=o.custom),!o.products||0===o.products.length)throw Error("Track: product list for purchase tracking is empty");o.products=Object.entries(o.products.reduce((function(t,r){var o=[r.id,r.line_id].join("|");return t[o]?t[o]=[t[o][0]+Number(r.amount),r]:t[o]=[r.amount,r],t}),{})).map((function(t){var r=tracker_slicedToArray(t,2),o=(r[0],r[1]);return{id:o[1].id,amount:o[0],price:o[1].price,line_id:o[1].line_id}})),o.products.forEach(this.buildParams.bind(this));break;case"recone_click":case"recone_view":this.queryParams.campaign=o.id,this.queryParams.inventory=o.inventory,this.queryParams.position=o.position,o.recommended_by&&(this.queryParams.recommended_by=o.recommended_by);break;case"search":"string"==typeof o?this.queryParams.search_query=o:(this.queryParams.search_query=o.query,null!=o.results&&(this.queryParams.results=o.results.join(",")));break;default:throw Error("Track: Undefined event ".concat(r))}}),[{key:"buildParams",value:function buildParams(t){var r={};if("object"===tracker_typeof(t)){if(!t.id)throw Error("Track: Item ID not set");r.id=t.id,t.amount&&(r.quantity=t.quantity||t.amount);for(var o=0,i=["price","line_id"];o<i.length;o++){var a=i[o];t[a]&&(r[a]=t[a])}(t.fashion_size||t.custom&&t.custom.fashion_size)&&(r.fashion_size=t.fashion_size||t.custom.fashion_size)}else{if("string"!=typeof t&&"number"!=typeof t)throw Error("Track: Incorrect syntax of the product argument: ".concat(t,". Number, string or extended object supported only. Check manual."));r.id=t}this.queryParams.items||(this.queryParams.items=[]),this.queryParams.items.push(r)}},{key:"send",value:function send(t,r){var o=this;if(t&&!this.queryParams.recommended_by&&(this.queryParams.recommended_by=t,!h.isTypeValid(t)))throw Error('Push: invalid type "'.concat(t,'"'));if(this.core.recommendedCode&&!this.queryParams.recommended_code&&(this.queryParams.recommended_code=this.core.recommendedCode),r&&(this.queryParams.source=JSON.stringify(r)),this.core.user.id&&(this.queryParams.user_id=this.core.user.id),this.core.user.email&&(this.queryParams.user_email=this.core.user.email),this.core.user.location&&(this.queryParams.user_location=this.core.user.location),r)switch(r.from){case"trigger_mail":case"digest_mail":case"web_push_trigger":case"web_push_digest":this.queryParams["".concat(r.from,"_code")]=r.code}return this.core.ajax.sendWithRetry("post",this.core.api.getAPIUrl("/push"),this.queryParams).then((function(t){if("function"==typeof o.success&&o.success(),"object"===tracker_typeof(t.payload)&&Object.keys(t.payload).length>0){if("function"==typeof window.gtag){if("purchase"===t.payload.event){var r={transaction_id:t.payload.transaction_id,value:t.payload.value,currency:t.payload.currency,items:t.payload.items};window.gtag("event","purchase",r)}"view"===t.payload.event&&window.gtag("event","view_item",{items:t.payload.items}),"cart"===t.payload.event&&window.gtag("event","add_to_cart",{items:t.payload.items}),"remove_from_cart"===t.payload.event&&window.gtag("event","remove_from_cart",{items:t.payload.items})}"object"===tracker_typeof(t.payload.popup)&&b.prepare(o.core,t.payload.popup)}}))}}],[{key:"trackUTM",value:function trackUTM(t,r){var o={shop_id:t.shop.token,did:t.user.did,sid:t.user.seance,seance:t.user.seance,utm:{}};for(var i in r)o.utm[i]=r[i];if(Object.keys(o.utm).length>0)return t.ajax.sendWithRetry("post",t.api.getAPIUrl("/push/utm"),o)}}])}();const _=v;function logger_typeof(t){return logger_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},logger_typeof(t)}function logger_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,logger_toPropertyKey(i.key),i)}}function logger_toPropertyKey(t){var r=function logger_toPrimitive(t,r){if("object"!=logger_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=logger_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==logger_typeof(r)?r:r+""}const w=function(){return function logger_createClass(t,r,o){return r&&logger_defineProperties(t.prototype,r),o&&logger_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Logger(t){!function logger_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Logger),this.debugLevel=t.debug||!1,this.label=t.label}),[{key:"log",value:function log(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._print("".concat(this.label.fullName().toUpperCase()," log: ").concat(r?"".concat(r.constructor.name,": "):"").concat(t))}},{key:"debug",value:function debug(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.debugLevel&&this._print("".concat(this.label.fullName().toUpperCase()," debug: ").concat(r?"".concat(r.constructor.name,": "):"").concat(t))}},{key:"warn",value:function warn(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._print("".concat(this.label.fullName().toUpperCase()," warning: ").concat(r?"".concat(r.constructor.name,": "):"").concat(t),!0)}},{key:"error",value:function error(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._print("%c".concat(this.label.fullName().toUpperCase()," error: ").concat(r?"".concat(r.constructor.name,": "):"").concat(t),!1,"color: red;")}},{key:"_print",value:function _print(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;void 0!==console.log?o?console.log(t,o):console.log(t):!0!==r&&alert(t)}}],[{key:"isDebug",value:function isDebug(){var t=!1,r=new Image;if(r.__defineGetter__("id",(function(){t=!0})),console&&(console.log(r),console.clear()),void 0===console.profile)return!1;console.profile(),console.profileEnd(),console.clear&&console.clear();try{chrome.tabs.query({url:"chrome-devtools://*/*"},(function(r){r.length>0&&(t=!0)}))}catch(t){}var o=new Date,i=new Date;return!0===t||console.profile.length>0||i-o>100}}])}();function api_typeof(t){return api_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},api_typeof(t)}function api_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,api_toPropertyKey(i.key),i)}}function api_toPropertyKey(t){var r=function api_toPrimitive(t,r){if("object"!=api_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=api_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==api_typeof(r)?r:r+""}const k=function(){return function api_createClass(t,r,o){return r&&api_defineProperties(t.prototype,r),o&&api_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function API(t,r,o,i){!function api_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,API),this.env=t,this.host=r,this.master_host=o,this.pictures_host=i,this.url=this.getProtocol()+this.getHost()}),[{key:"getProtocol",value:function getProtocol(){return("development"===this.env?location.protocol:"https:")+"//"}},{key:"getAPIUrl",value:function getAPIUrl(t){return this.url+t}},{key:"getHost",value:function getHost(){return this.host}},{key:"getMasterHost",value:function getMasterHost(){return this.master_host}},{key:"getPicturesHost",value:function getPicturesHost(){return this.pictures_host}}])}();var P=__webpack_require__(630),S=__webpack_require__(930);function ajax_typeof(t){return ajax_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ajax_typeof(t)}function ajax_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,ajax_toPropertyKey(i.key),i)}}function ajax_toPropertyKey(t){var r=function ajax_toPrimitive(t,r){if("object"!=ajax_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=ajax_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==ajax_typeof(r)?r:r+""}var C=function(){return function ajax_createClass(t,r,o){return r&&ajax_defineProperties(t.prototype,r),o&&ajax_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function AJAX(t){!function ajax_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,AJAX),this.core=t}),[{key:"send",value:function send(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return"post"===t.toLowerCase()?this.sendPost(r,o):this.sendGet(r,o)}},{key:"sendWithRetry",value:function sendWithRetry(t,r){var o=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this.send(t,r,i).catch((function(c){o.core.pushError(c,t,r,i),"function"==typeof a&&a(c)}))}},{key:"sendGet",value:function sendGet(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o="";return r instanceof URLSearchParams?(r.set("referer",document.URL||""),this.core.stream&&r.set("stream",this.core.stream),o=r.toString()):"object"===ajax_typeof(r)&&(this.core.testMode&&(r.testmode=!0),r.referer=document.URL||"",this.core.stream&&(r.stream=this.core.stream),o=S(r)),new P((function(r,i){var a=window.XDomainRequest||window.XMLHttpRequest,c=new a;c.withCredentials=!0;var l=function handleError(){var t=Error(c.statusText);t.code=c.status,i(t)};a===window.XDomainRequest?(c.open("GET","".concat(t,"?").concat(o),!0),c.onload=function handlerIE(){var t=c.responseText;t=JSON.parse(t),"function"==typeof r&&r(t)},c.onerror=l,c.send(null)):(c.open("GET","".concat(t,"?").concat(o),!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.onload=function handler(){if(4===c.readyState){if(200===c.status){var t=c.responseText;c.getResponseHeader("Content-Type").match(/application\/json/)&&(t=JSON.parse(t)),"function"==typeof r&&r(t)}c.status>=400&&l()}},c.onerror=l,c.send(null))}))}},{key:"sendPost",value:function sendPost(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"object"===ajax_typeof(r)&&r.constructor!==FormData&&(this.core.testMode&&(r.testmode=!0),r.referer=document.URL||"",this.core.stream&&(r.stream=this.core.stream),r=JSON.stringify(r)),new P((function(o,i){var a=new window.XMLHttpRequest;a.withCredentials=!0;var c=function handleError(){var t=Error(a.statusText);t.code=a.status,i(t)};a.open("POST",t,!0),"string"==typeof r&&a.setRequestHeader("Content-Type","application/json"),a.onload=function handler(){if(4===a.readyState&&a.status>=200&&a.status<300){var t=a.responseText;t&&(t=JSON.parse(t)),"function"==typeof o&&o(t)}a.status>=500&&c()},a.onerror=c,a.send(r)}))}}])}();const x=C;function nps_typeof(t){return nps_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nps_typeof(t)}function nps_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,nps_toPropertyKey(i.key),i)}}function nps_toPropertyKey(t){var r=function nps_toPrimitive(t,r){if("object"!=nps_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=nps_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==nps_typeof(r)?r:r+""}var E=function(){return function nps_createClass(t,r,o){return r&&nps_defineProperties(t.prototype,r),o&&nps_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function NPS(){!function nps_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,NPS)}),null,[{key:"setReview",value:function setReview(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!r||void 0===r)return t.logger.warn("NPS: the data shouldn't be empty");var a={};return r.email&&(a.email=r.email),r.phone&&(a.phone=r.phone),r.loyalty_id&&(a.loyalty_id=r.loyalty_id),r.order_id&&(a.order_id=r.order_id),r.channel&&"string"==typeof r.channel?(a.channel=r.channel,r.category&&"string"==typeof r.category?(a.category=r.category,!r.rate||"string"!=typeof r.rate&&"number"!=typeof r.rate?t.logger.warn('NPS: the "rate" param should be string or number'):("string"==typeof r.rate&&(r.rate=parseInt(r.rate)),a.rate=r.rate,"string"!=typeof r.comment&&void 0!==r.comment?t.logger.warn('NPS: the "comment" param should be a string'):(a.comment=r.comment,"string"==typeof r.label|void 0===r.label?(a.label=r.label,void(Object.keys(a).length>0&&(a.shop_id=t.shop.token,a.did=t.user.did,a.sid=t.user.seance,a.seance=t.user.seance,a.segment=t.segment||null,t.ajax.sendPost(t.api.getAPIUrl("/nps/create"),a).then(o,i).catch(i)))):t.logger.warn('NPS: the "label" param should be a string')))):t.logger.warn('NPS: the "category" param should be a string')):t.logger.warn('NPS: the "channel" param should be a string')}},{key:"getCategories",value:function getCategories(t,r,o){var i={shop_id:t.shop.token,did:t.user.did,sid:t.user.seance,seance:t.user.seance,segment:t.segment||null};t.ajax.sendGet(t.api.getAPIUrl("/nps/categories"),i).then(r,o).catch(o)}},{key:"getChannels",value:function getChannels(t,r,o){var i={shop_id:t.shop.token,did:t.user.did,sid:t.user.seance,seance:t.user.seance,segment:t.segment||null};t.ajax.sendGet(t.api.getAPIUrl("/nps/channels"),i).then(r,o).catch(o)}}])}();const A=E;function orders_typeof(t){return orders_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},orders_typeof(t)}function orders_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,orders_toPropertyKey(i.key),i)}}function orders_toPropertyKey(t){var r=function orders_toPrimitive(t,r){if("object"!=orders_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=orders_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==orders_typeof(r)?r:r+""}var T=function(){return function orders_createClass(t,r,o){return r&&orders_defineProperties(t.prototype,r),o&&orders_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Orders(){!function orders_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Orders)}),null,[{key:"last_for_user",value:function last_for_user(t,r,o){var i={shop_id:t.shop.token,did:t.user.did,sid:t.user.seance,seance:t.user.seance,segment:t.segment||null};t.ajax.sendGet(t.api.getAPIUrl("/orders/last_for_user"),i).then(r,o).catch(o)}}])}();const j=T;function promocode_typeof(t){return promocode_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},promocode_typeof(t)}function promocode_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,promocode_toPropertyKey(i.key),i)}}function promocode_toPropertyKey(t){var r=function promocode_toPrimitive(t,r){if("object"!=promocode_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=promocode_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==promocode_typeof(r)?r:r+""}var O=function(){return function promocode_createClass(t,r,o){return r&&promocode_defineProperties(t.prototype,r),o&&promocode_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Promocode(t){!function promocode_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Promocode),this.core=t}),[{key:"get",value:function get(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(o,i){var a=t.getFromCookie(r.id);a?(t.setToCookie(r.id,a),o(a)):t.core.ajax.sendGet(t.core.api.getAPIUrl("/promo_codes/fetch"),Object.assign({},{did:t.core.user.did,sid:t.core.user.seance,seance:t.core.user.seance,shop_id:t.core.shop.token},r)).then((function(i){if(!i.code)throw Error("There is no promo code in the API response. Response: ".concat(i));t.setToCookie(r.id,i.code),o(i.code)})).catch((function(t){i(t)}))}))}},{key:"getFromCookie",value:function getFromCookie(t){return r.default.get(this.getCookieName(t))}},{key:"setToCookie",value:function setToCookie(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";o&&r.default.set(this.getCookieName(t),o,{expires:7200,path:"/"},this.core)}},{key:"getCookieName",value:function getCookieName(t){return"".concat(this.core.label.fullName(),"_promocode_").concat(t)}}])}();const N=O;function segments_typeof(t){return segments_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},segments_typeof(t)}function segments_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,segments_toPropertyKey(i.key),i)}}function segments_toPropertyKey(t){var r=function segments_toPrimitive(t,r){if("object"!=segments_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=segments_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==segments_typeof(r)?r:r+""}var I=function(){function Segments(){!function segments_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Segments)}return function segments_createClass(t,r,o){return r&&segments_defineProperties(t.prototype,r),o&&segments_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(Segments,null,[{key:"add",value:function add(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=Segments.getParams(t,r);o&&Object.keys(o).length>0&&(o.shop_id=t.shop.token,o.did=t.user.did,o.sid=t.user.seance,o.seance=t.user.seance,o.segment=t.segment||null,t.ajax.sendWithRetry("post",t.api.getAPIUrl("/segments/add"),o))}},{key:"remove",value:function remove(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=Segments.getParams(t,r);o&&Object.keys(o).length>0&&(o.shop_id=t.shop.token,o.did=t.user.did,o.sid=t.user.seance,o.seance=t.user.seance,o.segment=t.segment||null,t.ajax.sendWithRetry("post",t.api.getAPIUrl("/segments/remove"),o))}},{key:"get",value:function get(t,r,o){var i={shop_id:t.shop.token,did:t.user.did,sid:t.user.seance,seance:t.user.seance,segment:t.segment||null};t.ajax.sendGet(t.api.getAPIUrl("/segments/get"),i).then(r,o).catch(o)}},{key:"getParams",value:function getParams(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o={};return r&&void 0!==r?("string"==typeof r.email?o.email=r.email.trim().toLowerCase():t.logger.debug('Segments: the "email" param should be a string'),"string"==typeof r.phone?o.phone=r.phone.trim():t.logger.debug('Segments: the "phone" param should be a string'),!r.segment_id||"string"!=typeof r.segment_id&&"number"!=typeof r.segment_id?t.logger.warn("Segments: a segment ID must be specified and should be string or number")||{}:("string"==typeof r.segment_id&&(r.segment_id=parseInt(r.segment_id)),o.segment_id=r.segment_id,o)):t.logger.warn("Segments: the params shouldn't be empty")||{}}}])}();const L=I;function trigger_typeof(t){return trigger_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},trigger_typeof(t)}function trigger_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,trigger_toPropertyKey(i.key),i)}}function trigger_toPropertyKey(t){var r=function trigger_toPrimitive(t,r){if("object"!=trigger_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=trigger_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==trigger_typeof(r)?r:r+""}var q=function(){return function trigger_createClass(t,r,o){return r&&trigger_defineProperties(t.prototype,r),o&&trigger_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Trigger(t){!function trigger_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Trigger),this.core=t}),[{key:"productAvailable",value:function productAvailable(t){this.makeRequest(t,"/subscriptions/subscribe_for_product_available")}},{key:"productPriceDecrease",value:function productPriceDecrease(t){if(!t.price||isNaN(parseFloat(t.price))||parseFloat(t.price)<1)throw Error("Incorrect price field");this.makeRequest(t,"/subscriptions/subscribe_for_product_price")}},{key:"productAvailableUnsubscribe",value:function productAvailableUnsubscribe(t){this.core.ajax.sendWithRetry("post",this.core.api.getAPIUrl("/subscriptions/unsubscribe_from_product_available"),t)}},{key:"productPriceDecreaseUnsubscribe",value:function productPriceDecreaseUnsubscribe(t){this.core.ajax.sendWithRetry("post",this.core.api.getAPIUrl("/subscriptions/unsubscribe_from_product_price"),t)}},{key:"makeRequest",value:function makeRequest(t,r){var o=this,i={shop_id:this.core.shop.token,did:this.core.user.did,item_id:t.item};switch("string"==typeof t.email&&he.validEmail(t.email)&&(i.email=t.email),t.price&&(i.price=t.price),t.properties&&(i.properties={},t.properties.barcode&&(i.properties.barcode=t.properties.barcode),t.properties.fashion_size&&(i.properties.fashion_size=t.properties.fashion_size)),!i.email&&!t.popup&&this.core.web_push&&this.core.web_push.enabled()&&this.core.web_push.supported()?i.type="webpush":i.type=t.popup,i.email&&t.webpush&&(i.type="all_channels"),i.type){case"webpush":this.core.web_push&&this.core.web_push.subscribe().then((function(){o.core.ajax.sendWithRetry("post",o.core.api.getAPIUrl(r),i)}));break;case"all_channels":i.type="email",this.core.ajax.sendPost(this.core.api.getAPIUrl(r),i).then((function(){o.core.web_push&&o.core.web_push.enabled()&&o.core.web_push.supported()&&(i.type="webpush",delete i.email,o.core.web_push.subscribe().then((function(){o.core.ajax.sendPost(o.core.api.getAPIUrl(r),i)})))}));break;default:i.type="email",(i.email||this.core.shop.has_email)&&this.core.ajax.sendWithRetry("post",this.core.api.getAPIUrl(r),i)}}},{key:"fetch",value:function fetch(t,r){if(void 0===r.item)throw Error("Incorrect item field");switch(t){case"product_available":return this.productAvailable(r);case"product_price_decrease":return this.productPriceDecrease(r)}}},{key:"fetchUnsubscribe",value:function fetchUnsubscribe(t,r){if(void 0===r.item_ids||!Array.isArray(r.item_ids))throw Error("Incorrect item_ids field");if("string"!=typeof r.email||!he.validEmail(r.email))throw Error("Incorrect email field");switch(r=Object.assign(r,{shop_id:this.core.shop.token,did:this.core.user.did,item_ids:r.item_ids.join(",")}),t){case"product_available":return this.productAvailableUnsubscribe(r);case"product_price_decrease":return this.productPriceDecreaseUnsubscribe(r)}}},{key:"fetchCheck",value:function fetchCheck(t,r,o,i){if(!(["string","number"].indexOf(trigger_typeof(r.item))+1))return this.core.logger.warn('The "item" parameter is missing or has the correct type');delete(r=Object.assign(r,{shop_id:this.core.shop.token,did:this.core.user.did,item_id:r.item})).item;var a=null;switch(t){case"product_available":a=this.core.api.getAPIUrl("/products/check_product_available_subscription");break;case"product_price_decrease":a=this.core.api.getAPIUrl("/products/check_price_drop_subscription");break;default:return this.core.logger.warn('Undefined "'.concat(t,'" method'))}this.core.ajax.sendGet(a,r).then(o).catch((function(t){if("function"!=typeof i)throw Error(t);i(t)}))}}])}();const R=q;function queue_typeof(t){return queue_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},queue_typeof(t)}function queue_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,queue_toPropertyKey(i.key),i)}}function queue_toPropertyKey(t){var r=function queue_toPrimitive(t,r){if("object"!=queue_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=queue_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==queue_typeof(r)?r:r+""}var M=function(){return function queue_createClass(t,r,o){return r&&queue_defineProperties(t.prototype,r),o&&queue_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Queue(t){!function queue_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Queue),this.queue=t||[]}),[{key:"length",get:function get(){return this.queue.length}},{key:"push",value:function push(t){this.queue.push(t)}},{key:"getInit",value:function getInit(){var t=this.findByName("init");if(t)return t;throw Error("Init command not found in queue")}},{key:"findByName",value:function findByName(t){for(var r=0;r<this.queue.length;r++)if(this.queue[r][0]===t)return this.queue.splice(r,1)[0]}},{key:"next",value:function next(){return this.queue.length>0?this.queue.splice(0,1)[0]:null}}])}();const U=M;function performer_typeof(t){return performer_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},performer_typeof(t)}function performer_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,performer_toPropertyKey(i.key),i)}}function performer_toPropertyKey(t){var r=function performer_toPrimitive(t,r){if("object"!=performer_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=performer_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==performer_typeof(r)?r:r+""}var B=function(){return function performer_createClass(t,r,o){return r&&performer_defineProperties(t.prototype,r),o&&performer_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Performer(t,r){!function performer_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Performer),this.queue=new U(t),this.logger=r,this.initialized=!1}),[{key:"push",value:function push(t){this.initialized?this.perform(t):this.queue.push(t)}},{key:"perform",value:function perform(){throw Error("This 'perform' is abstract method, please define in class ".concat(this.constructor.name))}},{key:"performQueue",value:function performQueue(){var t;if(this.logger.debug("Each queue",this),this.queue.length>0)for(this.logger.debug("Found ".concat(this.queue.length," tasks in queue"),this);null!==(t=this.queue.next());)this.perform(t)}}])}();const D=B;function reputation_typeof(t){return reputation_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},reputation_typeof(t)}function reputation_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,reputation_toPropertyKey(i.key),i)}}function reputation_toPropertyKey(t){var r=function reputation_toPrimitive(t,r){if("object"!=reputation_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=reputation_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==reputation_typeof(r)?r:r+""}var H=function(){return function reputation_createClass(t,r,o){return r&&reputation_defineProperties(t.prototype,r),o&&reputation_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Reputation(t){!function reputation_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Reputation),this.core=t}),[{key:"perform",value:function perform(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(t){case"css":this.core.addStyleToPage("reputation_css");break;case"get":case"product":case"widget":this[t](r,o)}}},{key:"get",value:function get(t,r){var o={shop_id:this.core.shop.token};t.count&&(o.count=t.count),t.offset&&(o.offset=t.offset),this.core.ajax.sendGet(this.core.api.getAPIUrl("/reputation/shop"),o).then(r)}},{key:"product",value:function product(t,r){if(!t.product_id)throw Error("Reputation: product_id not set");var o={shop_id:this.core.shop.token,product_id:t.product_id};t.count&&(o.count=t.count),t.offset&&(o.offset=t.offset),this.core.ajax.sendGet(this.core.api.getAPIUrl("/reputation/product"),o).then(r)}},{key:"widget",value:function widget(t,r){if(!t.style||-1===["white","green","grey"].indexOf(t.style))throw Error("Reputation: style is incorrect, please set in white, green, grey");var o={shop_id:this.core.shop.token,style:t.style};this.core.ajax.sendGet(this.core.api.getAPIUrl("/reputation/widget"),o).then(r)}}])}();const W=H;var G=__webpack_require__(289);function recorder_typeof(t){return recorder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},recorder_typeof(t)}function recorder_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,recorder_toPropertyKey(i.key),i)}}function recorder_toPropertyKey(t){var r=function recorder_toPrimitive(t,r){if("object"!=recorder_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=recorder_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==recorder_typeof(r)?r:r+""}const z=function(){return function recorder_createClass(t,r,o){return r&&recorder_defineProperties(t.prototype,r),o&&recorder_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Recorder(t,r){var o=this;!function recorder_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Recorder),this.config={bufferLen:4096,numChannels:2,mimeType:"audio/wav"},this.recording=!1,this.callbacks={getBuffer:[],exportWAV:[]},Object.assign(this.config,r),this.context=t.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.addEventListener("audioprocess",(function(t){if(o.recording){for(var r=[],i=0;i<o.config.numChannels;i++)r.push(t.inputBuffer.getChannelData(i));o.worker.postMessage({command:"record",buffer:r})}})),t.connect(this.node),this.node.connect(this.context.destination),this.worker=new G((function(){var t,r,o=0,i=[];function initBuffers(){for(var t=0;t<r;t++)i[t]=[]}function mergeBuffers(t,r){for(var o=new Float32Array(r),i=0,a=0;a<t.length;a++)o.set(t[a],i),i+=t[a].length;return o}function writeString(t,r,o){for(var i=0;i<o.length;i++)t.setUint8(r+i,o.charCodeAt(i))}this.onmessage=function(a){switch(a.data.command){case"init":!function init(o){t=o.sampleRate,r=o.numChannels,initBuffers()}(a.data.config);break;case"record":!function record(t){for(var a=0;a<r;a++)i[a].push(t[a]);o+=t[0].length}(a.data.buffer);break;case"exportWAV":!function exportWAV(a){for(var c,l=[],u=0;u<r;u++)l.push(mergeBuffers(i[u],o));c=2===r?function interleave(t,r){var o=t.length+r.length,i=new Float32Array(o),a=0,c=0;for(;a<o;)i[a++]=t[c],i[a++]=r[c],c++;return i}(l[0],l[1]):l[0];var d=function encodeWAV(o){var i=new ArrayBuffer(44+2*o.length),a=new DataView(i);return writeString(a,0,"RIFF"),a.setUint32(4,36+2*o.length,!0),writeString(a,8,"WAVE"),writeString(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,r,!0),a.setUint32(24,t,!0),a.setUint32(28,4*t,!0),a.setUint16(32,2*r,!0),a.setUint16(34,16,!0),writeString(a,36,"data"),a.setUint32(40,2*o.length,!0),function floatTo16BitPCM(t,r,o){for(var i=0;i<o.length;i++,r+=2){var a=Math.max(-1,Math.min(1,o[i]));t.setInt16(r,a<0?32768*a:32767*a,!0)}}(a,44,o),a}(c),p=new Blob([d],{type:a});this.postMessage({command:"exportWAV",data:p})}(a.data.type);break;case"getBuffer":!function getBuffer(){for(var t=[],a=0;a<r;a++)t.push(mergeBuffers(i[a],o));this.postMessage({command:"getBuffer",data:t})}();break;case"clear":!function clear(){o=0,i=[],initBuffers()}()}}}),{}),this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}}),this.worker.onmessage=function(t){var r=o.callbacks[t.data.command].pop();"function"==typeof r&&r(t.data.data)}}),[{key:"record",value:function record(){this.recording=!0}},{key:"stop",value:function stop(){this.recording=!1}},{key:"clear",value:function clear(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function getBuffer(t){if(!(t=t||this.config.callback))throw Error("Callback not set");this.callbacks.getBuffer.push(t),this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function exportWAV(t,r){if(r=r||this.config.mimeType,!(t=t||this.config.callback))throw Error("Callback not set");this.callbacks.exportWAV.push(t),this.worker.postMessage({command:"exportWAV",type:r})}}],[{key:"forceDownload",value:function forceDownload(t,r){var o=(window.URL||window.webkitURL).createObjectURL(t),i=window.document.createElement("a");i.href=o,i.download=r||"output.wav";var a=document.createEvent("Event");a.initEvent("click",!0,!0),i.dispatchEvent(a)}}])}();function speech_typeof(t){return speech_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},speech_typeof(t)}function speech_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,speech_toPropertyKey(i.key),i)}}function speech_toPropertyKey(t){var r=function speech_toPrimitive(t,r){if("object"!=speech_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=speech_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==speech_typeof(r)?r:r+""}var V=function(){return function speech_createClass(t,r,o){return r&&speech_defineProperties(t.prototype,r),o&&speech_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Speech(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function speech_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Speech),this.core=t,this.codec=r.codec,this.timeout=1e4}),[{key:"start",value:function start(t){var r=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.recorder||(navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then((function(a){r.stream=a,"wav"===r.codec?r.recordWav(t,o,i):r.recordOpus(t,o,i)})):this.core.logger.debug("Voice not supported on your browser"))}},{key:"send",value:function send(t,r,o){var i=new FormData;i.append("speech",t,"speech.wav"),i.append("shop_id",this.core.shop.token),i.append("did",this.core.user.did),this.core.ajax.sendPost(this.core.api.getAPIUrl("/push/say"),i).then(r,o).catch(o)}},{key:"recordWav",value:function recordWav(t){var r=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=(new(window.AudioContext||window.webkitAudioContext)).createMediaStreamSource(this.stream);this.recorder=new z(a),this.recorder.record();var c=setTimeout((function(){r.core.logger.debug("Cancel recording..."),r.recorder.stop(),l.stop(),r.recorder=null,r.stream.getAudioTracks().forEach((function(t){t.stop()})),o()}),this.timeout);this.core.logger.debug("Record...");var l=this.hark(this.stream,{});l.on("speaking",(function(){r.core.logger.debug("speaking")})),l.on("stopped_speaking",(function(){clearTimeout(c),r.core.logger.debug("stopped_speaking"),r.recorder&&(r.recorder.stop(),r.stream.getAudioTracks().forEach((function(t){t.stop()})),r.recorder.exportWAV((function(a){"function"==typeof i&&i(),r.send(a,t,o),r.recorder&&(r.recorder.clear(),r.recorder=null)}),"audio/wav")),o(),l.stop()}))}},{key:"recordOpus",value:function recordOpus(t){var r=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.recorder=new MediaRecorder(this.stream),this.recorder.start(),this.core.logger.debug("Record...");var a=setTimeout((function(){r.core.logger.debug("Cancel recording..."),r.recorder.stop(),l.stop(),r.recorder=null,r.stream.getAudioTracks().forEach((function(t){t.stop()})),o()}),this.timeout),c=[];this.recorder.addEventListener("dataavailable",(function(t){c.push(t.data)})),this.recorder.addEventListener("stop",(function(){"function"==typeof i&&i(),r.send(new Blob(c,{type:"audio/ogg; codecs=opus"}),t,o)}));var l=this.hark(this.stream,{});l.on("speaking",(function(){r.core.logger.debug("speaking")})),l.on("stopped_speaking",(function(){r.core.logger.debug("stopped_speaking"),clearTimeout(a),r.recorder.stop(),l.stop(),r.stream.getAudioTracks().forEach((function(t){t.stop()})),o(),r.recorder=null}))}},{key:"hark",value:function hark(t,r){var o=window.webkitAudioContext||window.AudioContext,i=this;if(i.events={},i.on=function(t,r){i.events[t]=r},i.emit=function(){i.events[arguments[0]]&&i.events[arguments[0]](arguments[1],arguments[2],arguments[3],arguments[4])},!o)return i;var a=(r=r||{}).smoothing||.1,c=r.interval||50,l=r.threshold,u=r.play,d=r.history||15,p=!0;window.audioContext00||(window.audioContext00=new o);var h,m,y,g=audioContext00.createGain();g.connect(audioContext00.destination),g.gain.value=0,(y=audioContext00.createAnalyser()).fftSize=512,y.smoothingTimeConstant=a,m=new Float32Array(y.fftSize),h=audioContext00.createMediaStreamSource(t),l=l||-50,h.connect(y),u&&y.connect(audioContext00.destination),i.speaking=!1,i.setThreshold=function(t){l=t},i.setInterval=function(t){c=t},i.stop=function(){p=!1,i.emit("volume_change",-100,l),i.speaking&&(i.speaking=!1,i.emit("stopped_speaking"))},i.speakingHistory=[];for(var b=0;b<d;b++)i.speakingHistory.push(0);var v=function looper(){setTimeout((function(){if(p){var t=function getMaxVolume(t,r){var o=-1/0;t.getFloatFrequencyData(r);for(var i=4,a=r.length;i<a;i++)r[i]>o&&r[i]<0&&(o=r[i]);return o}(y,m);i.emit("volume_change",t,l);var r=0;if(t>l&&!i.speaking){for(var o=i.speakingHistory.length-3;o<i.speakingHistory.length;o++)r+=i.speakingHistory[o];r>=2&&(i.speaking=!0,i.emit("speaking"))}else if(t<l&&i.speaking){for(var a=0;a<i.speakingHistory.length;a++)r+=i.speakingHistory[a];0===r&&(i.speaking=!1,i.emit("stopped_speaking"))}i.speakingHistory.shift(),i.speakingHistory.push(0+(t>l)),v()}}),c)};return v(),i}}],[{key:"init",value:function init(t,r){if(t.speech){var o=document.createElement("div");o.classList.add(t.label.fullName()+"-search-mic"),r.insertAdjacentElement("afterEnd",o),he.addEvent(o,"click",(function(i){i.preventDefault(),i.stopPropagation(),o.classList.add(t.label.fullName()+"-search-mic-active"),t.speech.start((function(i){o.classList.remove(t.label.fullName()+"-search-mic-active"),o.classList.remove(t.label.fullName()+"-search-mic-processing"),r.value=i.text,i.text&&he.dispatchEvent(r,"focus")}),(function(){o.classList.remove(t.label.fullName()+"-search-mic-active"),o.classList.remove(t.label.fullName()+"-search-mic-processing")}),(function(){o.classList.remove(t.label.fullName()+"-search-mic-active"),o.classList.add(t.label.fullName()+"-search-mic-processing")}))}))}}}])}();const K=V;function search_typeof(t){return search_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},search_typeof(t)}function search_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,search_toPropertyKey(i.key),i)}}function search_toPropertyKey(t){var r=function search_toPrimitive(t,r){if("object"!=search_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=search_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==search_typeof(r)?r:r+""}var J=function(){function Search(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function search_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Search),function search_defineProperty(t,r,o){return(r=search_toPropertyKey(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}(this,"core",void 0),t.classList.add(r.label.fullName()+"-instant-search-rendered"),this.core=r,this.initialize=!1,this.initialize_last_queries=!1,this.timer=null,this.results_object=null,this.active_item=-1,this.query_cache=[],this.top_products=[],this.last_queries=[],this.originalBodyOverflow=document.body.style.overflow,this.originalHtmlOverflow=document.documentElement.style.overflow,o.enabled&&(this.input=t,this.options=o,this.append_to_body=void 0===this.options.settings.append_to_body||this.options.settings.append_to_body,he.isMobile()||window.innerWidth,this.init())}return function search_createClass(t,r,o){return r&&search_defineProperties(t.prototype,r),o&&search_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(Search,[{key:"init",value:function init(){var t=this;this.core.addStyleToPage("search_css"),this.box=this.createItem("box"),this.box.classList.add("".concat(this.core.label.fullName(),"-search-box__").concat(this.options.type)),this.input.setAttribute("autocomplete","off"),this.input_url=this.input.getAttribute("data-".concat(this.core.label.fullName(),"-search-url")),this.input_url_prefix=this.input.getAttribute("data-".concat(this.core.label.fullName(),"-search-url-prefix")),this.append_to_body?(document.body.appendChild(this.box),this.box.classList.add("".concat(this.core.label.fullName(),"-search-box-body")),this.setBoxPosition(!0)):(this.input.parentNode.insertBefore(this.box,this.input),this.box.appendChild(this.input)),this.results=this.createItem("results"),this.box.appendChild(this.results),he.addEvent(this.input,"keydown",(function(t){-1!==[13,38,40].indexOf(t.keyCode)&&t.preventDefault()})),he.addEvent(this.input,"paste",this.search.bind(this)),he.addEvent(this.input,"keyup",this.search.bind(this)),he.addEvent(this.input,"focus",this.search.bind(this)),he.addEvent(this.input,"click",this.search.bind(this));var r=function closest(t,r){for(var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=null;t;){if(t.matches(r)){i=t;break}if(o&&t.matches(o))break;t=t.parentElement}return i}(this.input,"form");r&&he.addEvent(r,"submit",(function(r){r.preventDefault(),window.location=t.landingUrl(t.input.value)})),this.core.logger.debug("initialized",this),K.init(this.core,this.input)}},{key:"init_last_queries",value:function init_last_queries(t){var r=this;if(this.options.settings.enable_last_queries)if(this.initialize_last_queries)t();else{var o={shop_id:this.core.shop.token,did:this.core.user.did};this.core.ajax.sendGet(this.core.api.getAPIUrl("/search/blank"),o).then((function(o){r.last_queries=o.last_queries||[],r.suggests=o.suggests,r.last_products=o.last_products?o.products:[],r.top_products=o.last_products?[]:o.products,r.initialize_last_queries=!0,r.blank_html=o.html,t()}))}}},{key:"search",value:function search(t){var o=this;switch("paste"!==t.type&&(t.preventDefault(),t.stopPropagation()),t.keyCode){case 27:this.clear();break;case 40:t.preventDefault(),this.size()&&(this.active_item++,this.active_item>=this.size()&&(this.active_item=0)),this.changeActive(!0);break;case 38:t.preventDefault(),this.size()&&(this.active_item--,this.active_item<0&&(this.active_item=this.size()-1)),this.changeActive(!0);break;case 13:if(t.preventDefault(),t.stopPropagation(),"true"===r.default.get(this.core.label.fullName()+"_debug_mode",this.core.areCookiesForbidden())&&(console.log("Check redirect rules"),console.log(this.options.settings.enable_full_search),console.log(this.active_item),console.log(this.input.value),console.log(this.results_object.products_total),console.log(this.getRedirectLink(this.input.value))),this.options.settings.enable_full_search)if(this.active_item>=0){var i=this.results.querySelector(".".concat(this.core.label.fullName(),"-search-row__active"));i&&i.click()}else this.input.value&&(1!==this.results_object.products_total||this.getRedirectLink(this.input.value)?document.location=this.landingUrl(this.input.value):document.location=this.results_object.products[0].url);break;case 17:case 18:case 91:break;default:this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((function(){o.input.value&&o.input.value.trim().length>=1?o.input.value===o.last_search&&o.results_object&&o.results_object.search_query?o.printResults(o.results_object):(o.last_search=o.input.value,o.core.logger.debug("Search: "+o.last_search),o.get(o.input.value).then(o.printResults.bind(o))):o.init_last_queries((function(){o.options.settings.enable_last_queries&&(o.top_products.length||o.last_products.length)||o.last_queries&&o.last_queries.length||o.suggests.length?o.printResults({categories:[],products:o.top_products,last_products:o.last_products,virtual_categories:[],queries:o.suggests,last_queries:o.last_queries,collections:[],search_query_redirects:{},search_query:o.input.value,search_blank:!0,html:o.blank_html}):o.results.innerHTML=""}))}),"paste"===t.type?4:200)}}},{key:"get",value:function get(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a={shop_id:this.core.shop.token,did:this.core.user.did,sid:this.core.user.seance,type:"instant_search",search_query:t};return this.input.dataset.locations&&(a.locations=this.input.dataset.locations),o&&(a.exact_field_match=o),r&&(a.subquery=r),i&&(a.categories=i),this.core.ajax.sendGet(this.core.api.getAPIUrl("/search"),a)}},{key:"printResults",value:function printResults(t){var r=this;if(this.addOverflowHidden(),this.core.logger.debugLevel&&t&&console.log(this.input.value,t.search_query),t)if(this.clear(),this.results_object=t,this.active_item=-1,(0!==this.size()||0!==t.products.length||t.last_products&&0!==t.last_products.length)&&this.options.landing){var o,i,a;if(this.append_to_body&&this.setBoxPosition(),this.overlay=this.createItem("overlay"),document.body.appendChild(this.overlay),he.addEvent(this.overlay,"click",(function(){r.removeOverflowHidden(),r.clear(),r.input.blur()})),t.html){if(this.results.innerHTML=t.html,this.append_to_body&&he.isMobile()){var c=this.input.getBoundingClientRect(),l=window.innerHeight-c.bottom-50,u=l>0?l:window.innerHeight;this.results&&(this.results.style.maxHeight="".concat(u,"px"),this.results.style.overflowY="auto")}o=this.results.querySelector(".".concat(this.core.label.fullName(),"-search-wrapper")),this.container=i=this.results.querySelector(".".concat(this.core.label.fullName(),"-search-container")),a=this.results.querySelector(".".concat(this.core.label.fullName(),"-search-close")),[].forEach.call(i.querySelectorAll(".".concat(this.core.label.fullName(),'-search-row[data-remote="true"]')),(function(t){he.addEvent(t,"mouseover",(function(o){r.timer&&(clearTimeout(r.timer),r.timer=null),r.timer=setTimeout((function(){r.active_item=Array.prototype.slice.call(r.container.querySelectorAll(".".concat(r.core.label.fullName(),"-search-row"))).indexOf(t),r.changeActive(),r.get(t.getAttribute("data-id")?r.input.value:t.textContent.trim(),!0,null,t.getAttribute("data-id")).then((function(o){return r.printProducts(o,t.textContent.trim())}))}),200)}))})),[].forEach.call(i.querySelectorAll(".".concat(this.core.label.fullName(),"-search-container:first-child .").concat(this.core.label.fullName(),"-search-group-description")),(function(t){he.addEvent(t,"mouseout",(function(){r.timer&&(clearTimeout(r.timer),r.timer=null)}))}))}else{i=this.createItem("container"),o=this.createItem("wrapper"),a=this.createItem("close");var d=this.createItem("container");this.results.appendChild(o),o.appendChild(i),o.appendChild(d),o.appendChild(a),d.setAttribute("id",this.core.label.fullName()+"_search_products"),this.container=i;var p=function printQueries(t,o){i.appendChild(r.createGroup(t.map((function(t){return"suggested"!==r.options.type&&(t.callback=function(){r.query_cache[t.name]?r.printProducts(r.query_cache[t.name],t.name):r.get(t.name,!0).then((function(o){r.printProducts(o,t.name)}))}),t})),o))};t.last_queries&&t.last_queries.length&&p(t.last_queries,this.options.settings.last_queries_title||"Last queries"),t.queries&&t.queries.length&&p(t.queries,this.options.settings.suggestions_title||"Suggestions"),"suggested"!==this.options.type&&t.categories&&t.categories.length&&i.appendChild(this.createGroup(t.categories.map((function(t){return"suggested"!==r.options.type&&(t.callback=function(){var o="category-"+t.name+"-"+t.id+"-"+r.input.value;r.query_cache[o]?r.printProducts(r.query_cache[o],o):r.get(r.input.value,!0,null,t.id).then((function(t){r.printProducts(t,o)}))}),t})),this.options.settings.categories_title||"Categories")),t.search_blank&&(this.options.settings.popular_categories_title&&this.options.settings.popular_categories&&this.options.settings.popular_categories.length>0&&i.appendChild(this.createGroup(this.options.settings.popular_categories,this.options.settings.popular_categories_title)),this.options.settings.popular_brands_title&&this.options.settings.popular_brands&&this.options.settings.popular_brands.length>0&&i.appendChild(this.createGroup(this.options.settings.popular_brands,this.options.settings.popular_brands_title)),this.options.settings.popular_links_title&&this.options.settings.popular_links&&this.options.settings.popular_links.length>0&&i.appendChild(this.createGroup(this.options.settings.popular_links,this.options.settings.popular_links_title))),"suggested"!==this.options.type&&t.collections&&t.collections.length&&(this.results_object.collections=t.collections.map((function(t){return t.url=r.options.landing.replace(/%query%/g,r.input.value)+"".concat(r.getQueryParamChar(r.options.landing)).concat(r.core.label.name(),"_search_collection=").concat(t.id),t})),i.appendChild(this.createGroup(t.collections,"Sets"))),"suggested"!==this.options.type&&[["book_author",this.options.settings.book_author_title||"Authors"],["book_editor",this.options.settings.book_editor_title||"Editor"],["book_publisher",this.options.settings.book_publisher_title||"Publishing house"],["book_series",this.options.settings.book_series_title||"Series"],["book_illustrator",this.options.settings.book_illustrator_title||"Illustrator"]].forEach((function(o){t[o[0]]&&t[o[0]].length&&i.appendChild(r.createGroup(t[o[0]].map((function(t){return"suggested"!==r.options.type&&(t.callback=function(){var i="author-"+t.name;r.query_cache[i]?r.printProducts(r.query_cache[i],i):r.get(t.name,!0,o[0]).then((function(t){r.printProducts(t,i)}))}),t})),o[1]))}))}if(void 0!==o.getBoundingClientRect&&"suggested"!==this.options.type){var h=o.getBoundingClientRect(),m=0===this.size()?471:719;window.innerWidth&&(h.left<.6*window.innerWidth&&h.right>.4*window.innerWidth&&h.left+m>window.innerWidth?o.style.marginLeft=this.input.getBoundingClientRect().width/2-m/2+"px":h.left>=.6*window.innerWidth&&(o.classList.add(this.core.label.fullName()+"-search-wrapper__right"),o.style.marginLeft=-m+this.input.getBoundingClientRect().width+"px"))}if(he.addEvent(a,"click",(function(t){t.preventDefault(),t.stopPropagation(),r.removeOverflowHidden(),r.clear()})),this.input.getAttribute("data-inventory-banner")&&!he.isMobile()){var y=document.createElement("div");y.setAttribute("class","recone-banner-block"),y.setAttribute("data-type","banner"),y.setAttribute("data-id",this.input.getAttribute("data-inventory-banner")),i.appendChild(y),this.core.recone.banners()}if(this.active_item=-1,this.changeActive(),"suggested"!==this.options.type){this.printProducts(t,this.input.value);var g=this.input.getAttribute("data-".concat(this.core.label.fullName(),"-instant-search-callback"));g&&(void 0===window[g]?console.error("Global function "+g+" is not defined"):window[g](this.input,this.box,t))}}else this.removeOverflowHidden()}},{key:"printProducts",value:function printProducts(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this.results.querySelector("#".concat(this.core.label.fullName(),"_search_products"));if(i.innerHTML="",t.html){var a=document.createElement("div");a.innerHTML=t.html,i.innerHTML=a.querySelector("#".concat(this.core.label.fullName(),"_search_products")).innerHTML}else this.query_cache[r]||(this.query_cache[r]=t);var c,l=t.last_products&&t.last_products.length?t.last_products:t.products;if(l.length){if(t.html)c=i.querySelector(".".concat(this.core.label.fullName(),"-search-group"));else{c=this.createItem("group"),i.appendChild(c),c.classList.add(this.core.label.fullName()+"-search-products");var u=this.createItem("group-title");t.last_products&&t.last_products.length?u.innerText=this.options.settings.last_products_title||"Recently viewed":u.innerText=this.options.settings.items_title||"Possible item matches",c.appendChild(u);var d=this.createItem("group-description");c.appendChild(d);for(var p=0;p<l.length;p++)d.appendChild(this.productHtml(l[p]))}if((o||this.input.value.length>1)&&this.options.settings.enable_full_search){var h=this.createItem("group-description"),m=this.createItem("row","a");null===o&&(o=this.results.querySelector(".".concat(this.core.label.fullName(),"-search-row__active"))),c.appendChild(h),h.appendChild(m),m.setAttribute("href",o?o.getAttribute("href"):this.landingUrl(this.input.value)),m.textContent=(this.options.settings.show_all_title||this.options.results_title).replace("%query%",o?o.textContent:this.input.value).replace("%count%",t.products_total||"")}}}},{key:"productHtml",value:function productHtml(t){var r=this.createItem("product","a");return r.setAttribute("href",this.urlWithPrefix(t.url)),r.innerHTML='<div class="'.concat(this.core.label.fullName(),'-search-product__image" style="background-image: url(\'').concat(t.picture||t.image_url,"')\"></div>")+'<div class="'.concat(this.core.label.fullName(),'-search-product__name">').concat(t.name,"</div>")+(this.options.settings.enable_old_price?'<div class="'.concat(this.core.label.fullName(),'-search-product__old_price">')+(t.oldprice_full>0?t.oldprice_formatted:"")+"</div>":"")+'<div class="'.concat(this.core.label.fullName(),'-search-product__price">').concat(t.price_formatted,"</div>"),r}},{key:"getQueryParamChar",value:function getQueryParamChar(t){return-1===t.indexOf("?")?"?":"&"}},{key:"createGroup",value:function createGroup(t,r){var o=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=this.createItem("group"),c=this.createItem("group-title");c.innerText=r,a.appendChild(c);var l=this.createItem("group-description");return a.appendChild(l),he.addEvent(l,"mouseout",(function(){o.timer&&(clearTimeout(o.timer),o.timer=null)})),t.forEach((function(t){var r=o.createItem("row","a");t.callback?(he.addEvent(r,"mouseover",(function(i){o.timer&&(clearTimeout(o.timer),o.timer=null),o.timer=setTimeout((function(){o.active_item=Array.prototype.slice.call(o.container.querySelectorAll(".".concat(o.core.label.fullName(),"-search-row"))).indexOf(r),o.changeActive(),t.callback()}),200)})),r.setAttribute("href",t.url&&!o.getRedirectLink(t.name)?o.urlWithPrefix(t.url):o.landingUrl(t.name))):r.setAttribute("href",o.urlWithPrefix(t.url));var a=document.createElement("span");a.textContent=t.name,o.input.value&&i&&(a.innerHTML=a.innerHTML.replace(RegExp("(".concat(o.input.value.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),")"),"i"),"<b>$1</b>")),r.appendChild(a),l.appendChild(r)})),a}},{key:"size",value:function size(){return("suggested"!==this.options.type&&this.results_object.categories?this.results_object.categories.length:0)+(this.results_object.queries?this.results_object.queries.length:0)+("suggested"!==this.options.type&&this.results_object.collections?this.results_object.collections.length:0)}},{key:"clear",value:function clear(){this.results&&(this.results.innerHTML=""),this.overlay&&(this.overlay.parentNode.removeChild(this.overlay),this.overlay=null)}},{key:"urlWithPrefix",value:function urlWithPrefix(t){return t.match(/^\//)&&this.input_url_prefix&&(t=this.input_url_prefix+t),t}},{key:"landingUrl",value:function landingUrl(t){if(this.results_object&&this.results_object.search_query_redirects&&this.results_object.search_query_redirects.redirect_link)return this.results_object.search_query_redirects.redirect_link;var r=this.urlWithPrefix(this.getRedirectLink(t)||this.input_url||this.options.landing);return r?"".concat(r.replace(/%query%/g,encodeURIComponent(t)))+"".concat(this.getQueryParamChar(r)).concat(this.core.label.name(),"_search_query=").concat(encodeURIComponent(t),"&").concat(this.core.label.name(),"_input_query=").concat(encodeURIComponent(this.input.value)):"#"}},{key:"getRedirectLink",value:function getRedirectLink(t){return(t=t?t.toLowerCase().trim().replace(/\s+/g," "):"").length>0&&this.core.search.settings.redirects&&this.core.search.settings.redirects[t]?this.core.search.settings.redirects[t]:null}},{key:"changeActive",value:function changeActive(){var t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.size()&&[].forEach.call(this.results.querySelectorAll(".".concat(this.core.label.fullName(),"-search-row")),(function(o,i){i===t.active_item?(o.classList.add(t.core.label.fullName()+"-search-row__active"),r&&o.dispatchEvent(new MouseEvent("mouseover"))):o.classList.remove(t.core.label.fullName()+"-search-row__active")}))}},{key:"createItem",value:function createItem(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",o=document.createElement(r);return o.classList.add("".concat(this.core.label.fullName(),"-search-").concat(t)),o}},{key:"getOffsetSum",value:function getOffsetSum(t){for(var r=0,o=0;t;)r+=parseFloat(t.offsetTop),o+=parseFloat(t.offsetLeft),t=t.offsetParent;return{top:Math.round(r),left:Math.round(o)}}},{key:"getOffsetRect",value:function getOffsetRect(t){var r=t.getBoundingClientRect(),o=document.body,i=document.documentElement,a=window.pageYOffset||i.scrollTop||o.scrollTop,c=window.pageXOffset||i.scrollLeft||o.scrollLeft,l=i.clientTop||o.clientTop||0,u=i.clientLeft||o.clientLeft||0,d=r.top+a-l,p=r.left+c-u;return{top:Math.round(d),left:Math.round(p)}}},{key:"getOffset",value:function getOffset(t){return t.getBoundingClientRect?this.getOffsetRect(t):this.getOffsetSum(t)}},{key:"setBoxPosition",value:function setBoxPosition(){var t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=this.getOffset(this.input);this.box.style.top=o.top+this.input.offsetHeight+"px",this.box.style.left=o.left+"px",r&&he.addEvent(window,"scroll",(function(){t.box.style.top=t.getOffset(t.input).top+t.input.offsetHeight+"px"}))}},{key:"addOverflowHidden",value:function addOverflowHidden(){this.append_to_body&&he.isMobile()&&("hidden"!==document.body.style.overflow&&(document.body.style.overflow="hidden"),"hidden"!==document.documentElement.style.overflow&&(document.documentElement.style.overflow="hidden"))}},{key:"removeOverflowHidden",value:function removeOverflowHidden(){this.append_to_body&&he.isMobile()&&(document.body.style.overflow!==this.originalBodyOverflow&&(document.body.style.overflow=this.originalBodyOverflow),document.documentElement.style.overflow!==this.originalHtmlOverflow&&(document.documentElement.style.overflow=this.originalHtmlOverflow))}}],[{key:"initInstantSearch",value:function initInstantSearch(t){t.initialized&&t.search&&t.search.enabled&&[].forEach.call(document.querySelectorAll("input.".concat(t.label.fullName(),"-instant-search:not(.").concat(t.label.fullName(),"-instant-search-rendered)")),(function(r){new Search(r,t,t.search)}))}},{key:"initFullSearch",value:function initFullSearch(r){if(r.shop.token&&r.user.did&&r.search){var o=document.querySelectorAll("."+r.label.fullName()+"-full-search-results:not(."+r.label.fullName()+"-full-search-results-rendered)");if(0===o.length)return;r.addStyleToPage("search_css");var i=!1;[].forEach.call(o,(function(o,a){o.classList.add(r.label.fullName()+"-full-search-results-rendered");var c,l=o.getAttribute("data-search-query")||r.search_query,u=o.getAttribute("data-input-query")||r.input_query;if(l){var p={shop_id:r.shop.token,did:r.user.did,type:"full_search",search_query:l,input_query:u,seance:r.user.seance,exact_field_match:r.vars[r.label.name()+"_exact_field_match"]||null};if(t.SEARCH_KEYS.forEach((function(t){var r=o.getAttribute("data-search-"+t);r&&(p[t.replace("-","_")]=r.replace(/^\s+|\s+$/g,""))})),o.getAttribute("data-search-filters-block")&&document.querySelector(o.getAttribute("data-search-filters-block"))){var h={};try{h=JSON.parse(o.getAttribute("data-search-filters")||"{}")}catch(t){r.logger.error(t)}(c=new d(r,p,o.getAttribute("data-search-filters-block"),"/search",h)).setTotalResultSelector(o.getAttribute("data-search-total-block")),c.setSortSelector(o.getAttribute("data-search-sort-block"))}else r.logger.debug("Search filter block: "+o.getAttribute("data-search-filters-block")+", found: "+!!document.querySelector(o.getAttribute("data-search-filters-block")));var m=function renderSearchDiv(t,o){var i=function attachResult(o){void 0!==o.html?t.innerHTML=o.html:r.logger.error("Search template is missing."),void 0!==o.products_total&&t.setAttribute("data-search-response-total",o.products_total);var i=t.getAttribute("data-search-callback");i&&(void 0===window[i]?console.error("Global function "+i+" is not defined"):window[i](t,o))};r.logger.debug("Search attach results"),i(o),r.logger.debug("Search filters object: "+c),c&&(c.setCallback(i),c.print(o,!0))};r.logger.debug("Search request with data "+JSON.stringify(p)),r.ajax.sendGet(r.api.getAPIUrl("/search"),p).then((function(t){if(document.contains(o))m(o,t);else{r.logger.debug("Trying to find the search block again by its index if its pointer was lost.");var c=document.querySelectorAll("."+r.label.fullName()+"-full-search-results");void 0!==a&&void 0!==c[a]&&m(c[a],t)}"object"!==search_typeof(t.popup)||i||(i=!0,b.prepare(r,t.popup))})).catch((function(t){var r=o.getAttribute("data-search-error");r&&(void 0===window[r]?console.error("Global function "+r+" is not defined"):window[r](o))}))}else r.logger.error("Search query can not be blank for div implementation")}))}}}])}();const Y=J;function recone_typeof(t){return recone_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},recone_typeof(t)}function recone_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function recone_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,recone_toPropertyKey(i.key),i)}}function recone_createClass(t,r,o){return r&&recone_defineProperties(t.prototype,r),o&&recone_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function recone_toPropertyKey(t){var r=function recone_toPrimitive(t,r){if("object"!=recone_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=recone_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==recone_typeof(r)?r:r+""}var X=function(){return recone_createClass((function RecOne(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];recone_classCallCheck(this,RecOne),this.core=t,r&&this.addStyleToPage()}),[{key:"addStyleToPage",value:function addStyleToPage(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"recone",o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href","//".concat(this.core.api.getMasterHost(),"/").concat(r,"_css/").concat(this.core.shop.token,".css")),document.getElementsByTagName("head")[0].appendChild(o),o.onload=function(){t.banners(),t.popup()}}},{key:"perform",value:function perform(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("banners"===t)this.banners(r)}},{key:"banners",value:function banners(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};[].forEach.call(document.querySelectorAll(".recone-banner-block[data-id]"),(function(o){r.hasOwnProperty("rewrite")&&!0===r.rewrite&&(o.innerHTML="",o.classList.remove("recone-initialized")),new $(t.core,o)}))}},{key:"popup",value:function popup(){var t=this,r=document.querySelector('.recone-popup-block[data-type="popup"]');if(r){var o=parseInt(r.getAttribute("data-id")),i=r.getAttribute("data-category-id");if(o>0&&i){var a={did:this.core.user.did,shop_id:this.core.shop.token,id:o,seance:this.core.user.seance,sid:this.core.user.seance,category:i};this.core.ajax.sendGet(this.core.api.getAPIUrl("/popup"),a).then((function(o){if(o.items&&o.items.length){var i,a="";for(i in o.items){var c=o.items[i];c.url=c.url+(c.url.match(/\?/)?"&":"?")+"recommended_by=popular",a+='<a href="'.concat(c.url,'" class="').concat(t.core.label.fullName(),'-brand-popup__product">\n                                <div class="').concat(t.core.label.fullName(),'-brand-popup__product-image"><img src="').concat(c.image_url,'"></div>\n                                <div class="').concat(t.core.label.fullName(),'-brand-popup__product-title">').concat(c.name,'</div>\n                                <div class="').concat(t.core.label.fullName(),'-brand-popup__product-price">').concat("₽"===c.currency?c.price+" "+c.currency:c.currency+c.price,"</div>\n                            </a>")}r.innerHTML='<div class="'.concat(t.core.label.fullName(),'-brand-popup">\n                            <div class="').concat(t.core.label.fullName(),'-brand-popup__title"><span>').concat(o.title,'</span><span class="').concat(t.core.label.fullName(),'-brand-popup__title-close">X</span></div>\n                            <div class="').concat(t.core.label.fullName(),'-brand-popup__products">').concat(a,"</div>\n                        </div>"),he.addEvent(r.querySelector(".".concat(t.core.label.fullName(),"-brand-popup__title-close")),"click",(function(){r.innerHTML=""}))}}))}else this.core.logger.error("Incorrect inventory id or blank category id")}}}])}(),$=function(){return recone_createClass((function Banner(t,r){var o=this;if(recone_classCallCheck(this,Banner),this.core=t,r&&!r.classList.contains("recone-initialized")){r.classList.add("recone-initialized");var i={did:this.core.user.did,shop_id:this.core.shop.token,id:r.getAttribute("data-id"),sid:this.core.user.seance,seance:this.core.user.seance};this.core.ajax.sendGet(this.core.api.getAPIUrl("/banner"),i).then((function(t){if(t.banners.length){var i=document.createElement("img");i.classList.add("recone-banner-template"),i.src=t.banners[0].image,i.style.visibility="hidden",r.style.maxWidth=t.settings.width+"px",r.appendChild(i);var a=document.createElement("div");a.classList.add("recone-banner-container-control"),r.appendChild(a);for(var c=0;c<t.banners.length;c++)t.banners.length>1&&a.appendChild(o.makeRadioControl(r,t,c)),a.appendChild(o.makeBanner(t.banners[c]));t.banners.length>1&&(r.appendChild(o.bannerControl("left",(function(){o.bannerPrev(r,t)}))),r.appendChild(o.bannerControl("right",(function(){o.bannerNext(r,t)})))),o.bannerChangeActive(r,0)}}))}}),[{key:"bannerControl",value:function bannerControl(t,r){var o=document.createElement("div");return o.classList.add("recone-banner-control-"+t),o.innerHTML='<svg width="32" height="32" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <g fill="#657786" fill-rule="evenodd">\n    <path id="a" d="M8 9L4 5 3 6l5 5 5-5-1-1z"/>\n  </g>\n</svg>',he.addEvent(o,"click",r),o}},{key:"bannerRunTimer",value:function bannerRunTimer(t,r){var o=this;this.bannerTimer&&clearTimeout(this.bannerTimer),r.banners.length>1&&(this.bannerTimer=setTimeout((function(){o.bannerNext(t,r)}),1e3*r.settings.timeout))}},{key:"bannerNext",value:function bannerNext(t,r){var o=t.querySelector("input.".concat(this.core.label.fullName(),"-banner-control:checked")),i=o?o.value-1:0;++i>=r.banners.length&&(i=0),this.bannerChangeActive(t,i)}},{key:"bannerPrev",value:function bannerPrev(t,r){var o=t.querySelector("input.".concat(this.core.label.fullName(),"-banner-control:checked")),i=o?o.value-1:0;--i<0&&(i=r.banners.length-1),this.bannerChangeActive(t,i)}},{key:"bannerChangeActive",value:function bannerChangeActive(t,r){var o=t.querySelectorAll("input.".concat(this.core.label.fullName(),"-banner-control"))[r];o&&(o.checked=!0,he.dispatchEvent(o,"change"))}},{key:"makeRadioControl",value:function makeRadioControl(t,r,o){var i=this,a=document.createElement("input"),c=r.banners[o];return a.setAttribute("type","radio"),a.setAttribute("id",this.core.label.fullName()+"_carousel_control_"+t.getAttribute("data-id")+"_"+c.position),a.setAttribute("name",this.core.label.fullName()+"-carousel-"+t.getAttribute("data-id")),a.classList.add(this.core.label.fullName()+"-banner-control"),a.value=c.position,he.addEvent(a,"change",(function(){i.bannerRunTimer(t,r);for(var o=a.cloneNode(!1);a.firstChild;)o.appendChild(a.lastChild);a.parentNode.replaceChild(o,a),he.addEvent(o,"change",(function(){i.bannerRunTimer(t,r)}))})),a}},{key:"makeBanner",value:function makeBanner(t){var r=this,o=document.createElement("a");o.setAttribute("href",t.url),o.setAttribute("target","_blank"),o.setAttribute("rel","nofollow"),o.style.position="absolute",o.style.top="0",o.onclick=function(){window[r.core.label.name()]("track","recone_click",{id:t.id,inventory:t.inventory,position:t.position,recommended_by:"banner"})};var i=document.createElement("img");return i.onload=function(){},i.src=t.image,o.appendChild(i),o}}])}();const Q=X;function web_push_typeof(t){return web_push_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},web_push_typeof(t)}function web_push_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,web_push_toPropertyKey(i.key),i)}}function web_push_toPropertyKey(t){var r=function web_push_toPrimitive(t,r){if("object"!=web_push_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=web_push_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==web_push_typeof(r)?r:r+""}var Z=function(){function WebPush(t,r){!function web_push_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,WebPush),this.core=t,this.settings=r,this.settings.public_key&&"string"==typeof this.settings.public_key&&(this.settings.public_key=this.urlBase64ToUint8Array(this.settings.public_key)),this.supported()&&this.registerServiceWorker()}return function web_push_createClass(t,r,o){return r&&web_push_defineProperties(t.prototype,r),o&&web_push_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(WebPush,[{key:"supported",value:function supported(){return!!this.enabled()&&(-1===navigator.userAgent.toLowerCase().indexOf("msie")&&(WebPush.supportedSafari()&&this.enabledSafari()||!WebPush.supportedSafari()&&(WebPush.supportedOpera()||WebPush.supportedWebkit())?"denied"!==this.permission()||(this.core.logger.error("Web push subscription is blocked in the current browser. Please check your browser settings and ensure that web push notifications are allowed.",this),!1):(this.core.logger.debug("Notifications aren't supported.",this),!1)))}},{key:"enabled",value:function enabled(){return this.settings&&("localhost"===document.location.hostname||"https:"===document.location.protocol)&&!this.core.browserIsPrivateMode&&("417dfce51c4cc3cc2fe3da5480db10"!==this.core.shop.token||"A"===r.default.get(this.core.label.fullName()+"VisitorSegment",this.core.areCookiesForbidden()))}},{key:"enabledSafari",value:function enabledSafari(){return this.settings&&this.settings.safari_enabled}},{key:"registerServiceWorker",value:function registerServiceWorker(){var t=this;WebPush.supportedSafari()?"granted"===this.safariPermission().permission&&(this.subscription=!0):navigator.serviceWorker.register(this.settings.service_worker||"/push_sw.js").then((function(r){t.core.logger.debug("Service Worker is ready",t);try{navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({did:t.core.user.did,shop_id:t.core.shop.token})}catch(r){t.core.logger.debug("Service Worker error: "+r,t)}"granted"===Notification.permission&&r.pushManager.getSubscription().then((function(o){if(!o||JSON.stringify(new Uint8Array(o.options.applicationServerKey))===JSON.stringify(new Uint8Array(t.settings.public_key)))return o?t.sendRegistrationToken(JSON.stringify(o.toJSON())):t.requestSubscribe(r);t.core.logger.debug("applicationServerKey in subscription does not match settings.public_key, resubscribe",t),o.unsubscribe().then((function(o){return t.requestSubscribe(r)})),o=null}))})).catch((function(r){t.core.logger.error("Service Worker error: "+r)}))}},{key:"subscribe",value:function subscribe(){var t=this,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.supported())return WebPush.supportedSafari()?this.checkSafariRemotePermission(this.safariPermission()):navigator.serviceWorker.ready.then((function(i){return i.pushManager.getSubscription().then((function(a){return a?function subscribed(i){return o?JSON.stringify(i.toJSON()):t.sendRegistrationToken(JSON.stringify(i.toJSON()),r)}(a):"default"===Notification.permission?(t.core.logger.debug("Web push notification requestPermission"),Notification.requestPermission().then((function(r){if("granted"!==r)throw"denied"===r&&t.unsubscribed(),Error("Bad permission result");return t.requestSubscribe(i,o)}))):void 0}))}));this.core.logger.error("Web push subscription is not supported in the current browser. Please use a modern browser that supports web push notifications.")}},{key:"urlBase64ToUint8Array",value:function urlBase64ToUint8Array(t){for(var r=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(r),i=new Uint8Array(o.length),a=0;a<o.length;++a)i[a]=o.charCodeAt(a);return i}},{key:"requestSubscribe",value:function requestSubscribe(t){var r=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.core.logger.debug("Web push request subscribe"),t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:new Uint8Array(this.settings.public_key)}).then((function(t){return r.core.logger.debug("Web push request subscribed with token: "+JSON.stringify(t.toJSON())),o?JSON.stringify(t.toJSON()):r.sendRegistrationToken(JSON.stringify(t.toJSON()),!0)})).catch((function(t){r.core.logger.error(t,r)}))}},{key:"unsubscribed",value:function unsubscribed(){var t=this;this.core.ajax.sendWithRetry("post",this.core.api.getAPIUrl("/web_push_subscriptions/decline"),{shop_id:this.core.shop.token,did:this.core.user.did}).then((function(){t.core.logger.debug("The user has unsubscribed, the data has been successfully sent to the server.")}))}},{key:"safariPermission",value:function safariPermission(){return window.safari.pushNotification.permission(this.settings.safari_id)}},{key:"permission",value:function permission(){return(WebPush.supportedSafari()?this.safariPermission():Notification).permission}},{key:"isSubscribed",value:function isSubscribed(){return this.supported()&&"granted"===this.permission()}},{key:"checkSafariRemotePermission",value:function checkSafariRemotePermission(t){var r=this;return new Promise((function(o,i){if("default"===t.permission)return r.safariRequestPermission();if("denied"===t.permission)r.core.logger.debug("The user has blocked notifications.",r),r.unsubscribed(),i();else if("granted"===t.permission)return r.initialized=!0,r.subscription=!0,r.sendRegistrationToken(JSON.stringify({browser:"safari",token:t.deviceToken})).then(o)}))}},{key:"safariRequestPermission",value:function safariRequestPermission(){var t=this;return new Promise((function(r,o){window.safari.pushNotification.requestPermission(t.core.api.getAPIUrl("/web_push_subscriptions/safari_webpush?shop_id="+t.core.shop.token+"&type="),t.settings.safari_id,{},(function(i){t.checkSafariRemotePermission(i).then(r).catch(o)}))}))}},{key:"sendRegistrationToken",value:function sendRegistrationToken(t){var r=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(i,a){r.core.logger.debug("token: ".concat(t,", force: ").concat(o),r);var c=new Date,l=c.getFullYear()+":"+c.getMonth()+":"+c.getDate();o||localStorage.getItem(r.core.label.fullName()+"_webpush_sync")!==l?(localStorage.setItem(r.core.label.fullName()+"_webpush_sync",l),y.set(r.core,{web_push_token:t},(function(){return i(t)}),a)):i(t)}))}}],[{key:"supportedWebkit",value:function supportedWebkit(){return"serviceWorker"in navigator&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window}},{key:"supportedSafari",value:function supportedSafari(){return"safari"in window&&"object"==web_push_typeof(window.safari)&&"pushNotification"in window.safari}},{key:"supportedOpera",value:function supportedOpera(){return!(window.navigator.userAgent.indexOf("OPR")>-1||window.navigator.userAgent.indexOf("Opera")>-1)&&WebPush.supportedWebkit()}}])}();const ee=Z;function products_typeof(t){return products_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},products_typeof(t)}function ownKeys(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);r&&(i=i.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),o.push.apply(o,i)}return o}function products_defineProperty(t,r,o){return(r=products_toPropertyKey(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function products_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,products_toPropertyKey(i.key),i)}}function products_toPropertyKey(t){var r=function products_toPrimitive(t,r){if("object"!=products_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=products_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==products_typeof(r)?r:r+""}var te=function(){return function products_createClass(t,r,o){return r&&products_defineProperties(t.prototype,r),o&&products_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function Products(){!function products_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Products)}),null,[{key:"fetchProducts",value:function fetchProducts(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=function _objectSpread(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(o),!0).forEach((function(r){products_defineProperty(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))}))}return t}({shop_id:t.shop.token},r);return t.ajax.sendGet(t.api.getAPIUrl("/products"),o)}},{key:"counters",value:function counters(t,r){if(!r)throw'Argument "item" required';var o={shop_id:t.shop.token,item:r};return t.ajax.sendGet(t.api.getAPIUrl("/products/counters"),o)}}])}();const re=te;function createTextBlock(t,r){var o=r.text_align,i=void 0===o?"left":o,a=r.text_background_color,c=void 0===a?"transparent":a,l=r.text_background_color_opacity,u=r.y_offset,d=r.text_input,p=r.bold,h=r.font_size,m=r.font_type,y=void 0===m?"inherit":m,g=r.italic,b=r.text_color,v=void 0===b?"#000":b,_=r.text_line_spacing,w=t.createItem("element-text-block","div");w.style.textAlign=i,w.style.backgroundColor=c,l&&(w.style.backgroundColor=function calculateOpacity(t,r){if(!t||!r)return t;var o=parseFloat(r);if(isNaN(o)||o<0||o>100)return console.warn("Invalid opacity value:",r),t;var i=o/100;if(t.startsWith("#")){if(3===(t=t.replace("#","")).length&&(t=t.split("").map((function(t){return t+t})).join("")),6!==t.length)return console.warn("Invalid hex color format:",t),t;var a=parseInt(t.substring(0,2),16),c=parseInt(t.substring(2,4),16),l=parseInt(t.substring(4,6),16);return"rgba(".concat(a,", ").concat(c,", ").concat(l,", ").concat(i,")")}return t.startsWith("rgb")?t.replace("rgb","rgba").replace(")",", ".concat(i,")")):(console.warn("Invalid color format:",t),t)}(c,l)),w.style.top="".concat(u,"%");var k=document.createElement("span");return k.textContent=d,k.style.fontWeight=p?"bold":"normal",k.style.fontSize=h?"".concat(h,"px"):"inherit",k.style.fontFamily=y,k.style.fontStyle=g?"italic":"normal",k.style.color=v,k.style.lineHeight=_||"normal",l&&"0%"!==l&&(k.style.margin="0 16px"),w.appendChild(k),w}var oe=__webpack_require__(132);function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return stories_arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function stories_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return stories_arrayLikeToArray(t,r);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?stories_arrayLikeToArray(t,r):void 0}}(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function stories_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,i=Array(r);o<r;o++)i[o]=t[o];return i}function stories_typeof(t){return stories_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},stories_typeof(t)}function stories_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function stories_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,stories_toPropertyKey(i.key),i)}}function stories_createClass(t,r,o){return r&&stories_defineProperties(t.prototype,r),o&&stories_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function stories_toPropertyKey(t){var r=function stories_toPrimitive(t,r){if("object"!=stories_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=stories_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==stories_typeof(r)?r:r+""}var ne=function(){function Stories(t,r){stories_classCallCheck(this,Stories),this.core=t,this.container=r,this.code=r.getAttribute("data-code"),this.startCampaign=!1,r.classList.add(t.label.fullName()+"-stories-rendered"),this.buildSkeleton(),this.code?this.core.ajax.sendGet(this.core.api.getAPIUrl("/stories/"+this.code),{shop_id:this.core.shop.token,did:this.core.user.did,sid:this.core.user.seance}).then(this.printResults.bind(this)):t.logger.error("Story block code is missing")}return stories_createClass(Stories,[{key:"buildSkeleton",value:function buildSkeleton(){for(var t=0;t<3;t++){var r=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div");o.classList.add("story-skeleton-avatar"),i.classList.add("story-skeleton-name"),r.classList.add("story-skeleton"),r.append(o,i),this.container.append(r)}}},{key:"printResults",value:function printResults(t){this.id=t.id,this.stories=t.stories,this.stories&&this.stories.length?this.addStyleToPage().then(function(){var t=this;this.container.textContent="",this.container.classList.add(this.prefix()),document.body.addEventListener("keyup",(function(r){"Escape"===r.key&&t.close()}));for(var r=0;r<this.stories.length;r++)this.buildStory(r);this.updateViewed(),this.startStory()}.bind(this)):this.container.remove()}},{key:"startStory",value:function startStory(){this.startCampaign&&this.showStory(0)}},{key:"addStyleToPage",value:function addStyleToPage(){var t=this,r="".concat(this.core.label.fullName(),"-story-css-").concat(this.id);return document.getElementById(r)?Promise.resolve():new Promise((function(o){var i=document.createElement("link");i.setAttribute("id",r),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href","//".concat(t.core.api.getMasterHost(),"/stories_css/").concat(t.core.shop.token,"_").concat(t.id,".css")),i.onload=o,document.getElementsByTagName("head")[0].appendChild(i)}))}},{key:"buildStory",value:function buildStory(t){var r=this,o=this.stories[t],i=this.createItem("story","div"),a=this.createItem("story-avatar","img"),c=this.createItem("story-name","div");a.setAttribute("src",o.avatar),a.classList.add("loading"),a.setAttribute("title",o.name),a.setAttribute("alt",o.name),c.textContent=o.name,a.onload=function(){this.classList.remove("loading")},i.append(a,c),i.addEventListener("click",(function(o){o.preventDefault(),o.stopPropagation(),r.showStory(t)})),this.container.append(i)}},{key:"updateViewed",value:function updateViewed(){for(var t=this.container.querySelectorAll("."+this.prefix()+"-story ."+this.prefix()+"-story-avatar"),r=0;r<this.stories.length;r++)t[r].classList.toggle(this.prefix()+"-story-avatar-not-viewed",!this.stories[r].viewed)}},{key:"showStory",value:function showStory(t){var r=this;this.close();var o,i,a,c=this.createItem("background"),l=this.createItem("preview"),u=0,d=0,p=0,h=this,m=100;function mouseDown(t){t&&!t.hasOwnProperty("touches")&&(u=t.clientX,d=t.clientY),o=!1,i=setTimeout((function(){o=!0,a.pause()}),200)}function mouseUp(t){t&&!t.hasOwnProperty("touches")&&Math.abs(u-t.clientX)<Math.abs(d-t.clientY)&&-1*(d-t.clientY)>m&&h.close(),clearTimeout(i)}c.append(l,this.createItem("close")),c.addEventListener("click",this.close.bind(this)),l.addEventListener("mousedown",mouseDown),l.addEventListener("mouseup",mouseUp),l.addEventListener("touchstart",mouseDown),l.addEventListener("touchend",(function(){mouseUp(),a.resume()})),l.addEventListener("prev",(function(){t<=0?r.close():a=new ie(r,l,--t)})),l.addEventListener("next",(function(o){r.stories[t].viewed=!0,r.updateViewed(),t+1>=r.stories.length?r.close():a=new ie(r,l,++t)})),l.addEventListener("click",(function(t){t.stopPropagation(),o?a.resume():(clearTimeout(i),t.offsetX/t.target.offsetWidth<.5?a.prev():a.next())})),l.addEventListener("touchstart",(function(t){u=t.changedTouches[t.changedTouches.length-1].screenX,d=t.changedTouches[t.changedTouches.length-1].screenY})),l.addEventListener("touchend",(function(o){p=o.changedTouches[o.changedTouches.length-1].screenX;var i=o.changedTouches[o.changedTouches.length-1].screenY,c=d-i;Math.abs(u-p)<Math.abs(c)&&Math.abs(c)>m&&r.close(),u>p&&u-p>m?l.dispatchEvent(new Event("next")):p>u&&p-u>m&&(t<=0?r.close():a=new ie(r,l,--t))})),l.oncontextmenu=function(t){return t.preventDefault(),t.stopPropagation(),!1},a=new ie(this,l,t),document.body.append(c)}},{key:"close",value:function close(){this.interval&&clearInterval(this.interval);var t=document.querySelector(".".concat(this.prefix(),"-background"));t&&t.remove(),document.body.style.overflow=""}},{key:"createItem",value:function createItem(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",o=document.createElement(r);return o.classList.add("".concat(this.prefix(),"-").concat(t)),o}},{key:"prefix",value:function prefix(){return this.core.label.fullName()+"-stories-"+this.id}},{key:"track",value:function track(t,r,o){return this.core.ajax.sendPost(this.core.api.getAPIUrl("/track/stories"),{shop_id:this.core.shop.token,did:this.core.user.did,sid:this.core.user.seance,event:t,code:this.code,story_id:r,slide_id:o})}}],[{key:"init",value:function init(t){t.shop.token&&t.user.did&&t.user.seance&&[].forEach.call(document.querySelectorAll(".".concat(t.label.fullName(),"-stories[data-code]:not(.").concat(t.label.fullName(),"-stories-rendered)")),(function(r){new Stories(t,r)}))}}])}(),ie=function(){return stories_createClass((function StoryView(t,r,o){var i=this;stories_classCallCheck(this,StoryView),this.promocodeCopyText=t.container.getAttribute("data-promocode-copy-text")||oe.PROMOCODE_COPY_TEXT,this.parent=t,this.position=o,this.progress=new ae(this,t.stories[o]),this.container=this.parent.createItem("container"),this.carousel=this.parent.createItem("carousel"),this.preview=r,this.active=!1,this.shadowLayer=this.parent.createItem("shadow"),this.nextSlideContainer="",this.prevSlideContainer="",this.shadowLayer.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation()})),window.screen.width>=980&&(this.prevSlideContainer=this.parent.createItem("prev"),this.nextSlideContainer=this.parent.createItem("next"),this.prevSlideContainer.addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),0===i.position?i.parent.close():i.preview.dispatchEvent(new Event("prev"))})),this.nextSlideContainer.addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),i.preview.dispatchEvent(new Event("next"))}))),r.replaceChildren.apply(r,_toConsumableArray(this.build())),this.show()}),[{key:"prev",value:function prev(){var t=this.parent.stories[this.position];this.active=!1,t.start_position--,t.start_position<0?(t.start_position=0,this.preview.dispatchEvent(new Event("prev"))):this.show()}},{key:"next",value:function next(){var t=this.parent.stories[this.position];this.active=!1,t.start_position++,t.start_position>=t.slides.length?(t.start_position=0,this.preview.dispatchEvent(new Event("next"))):this.show()}},{key:"pause",value:function pause(){this.active=!1;var t=this.container.querySelector("video");t&&t.pause()}},{key:"resume",value:function resume(){this.active=!0;var t=this.container.querySelector("video");t&&t.play()}},{key:"build",value:function build(){return[this.progress.build(),this.prevSlideContainer,this.container,this.nextSlideContainer]}},{key:"show",value:function show(){var t,r,o,i,a=this;this.progress.show();var c,l,u,d=this.parent.stories[this.position],p=d.slides[d.start_position],h=0!==this.position&&this.parent.stories[this.position-1].slides[this.parent.stories[this.position-1].start_position],m=this.position!==this.parent.stories.length-1&&this.parent.stories[this.position+1].slides[this.parent.stories[this.position+1].start_position],y=new le(this.container,this.parent.container.getAttribute("data-error-message")),g=null!==(t=null===(r=this.parent.stories[this.position-1])||void 0===r?void 0:r.avatar)&&void 0!==t?t:"",b=null!==(o=null===(i=this.parent.stories[this.position+1])||void 0===i?void 0:i.avatar)&&void 0!==o?o:"";switch(this.container.textContent="",p.hasOwnProperty("background_color")?this.container.style.backgroundColor=p.background_color:this.container.style.backgroundColor="",p.type){case"image":ce.match(p.background)?c=ce.get(p.background).cloneNode(!0):(c=new Image).src=p.background,c.classList.add("".concat(this.parent.prefix(),"-container-image")),c.addEventListener("load",(function(t){return y.stopLoading(),a.active=!0,a.progress.items[d.start_position].animate(1e3*p.duration||5e3)})),y.startLoading(c);break;case"video":c=document.createElement("video"),(u=document.createElement("div")).style.display="none",c.setAttribute("src",p.background),c.setAttribute("type","video/".concat(p.background.substring(p.background.lastIndexOf(".")+1))),c.setAttribute("playsinline","playsinline"),c.setAttribute("webkit-playsinline","webkit-playsinline"),c.muted=null===localStorage.getItem("".concat(this.parent.core.label.fullName(),"-stories-mute"))||"true"===localStorage.getItem("".concat(this.parent.core.label.fullName(),"-stories-mute")),p.preview&&(c.poster=p.preview),c.autoplay=!0,c.addEventListener("canplay",(function(t){setTimeout((function(){(c.mozHasAudio||c.webkitAudioDecodedByteCount||c.audioTracks&&c.audioTracks.length)&&(u.style.display="block")}),200),a.active=!0,"block"===window.getComputedStyle(c,null).getPropertyValue("display")&&"block"!==window.getComputedStyle(a.carousel,null).getPropertyValue("display")&&(a.progress.items[d.start_position].animate(1e3*c.duration),c.play())})),c.addEventListener("waiting",(function(){return a.active=!1})),c.addEventListener("playing",(function(){return a.active=!0})),u.classList.add("mute-btn"),c.muted&&u.classList.add("mute"),u.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),c.muted=!c.muted,u.classList.toggle("mute"),localStorage.setItem("".concat(a.parent.core.label.fullName(),"-stories-mute"),!!c.muted)})),y.startLoading(c);break;default:if(!p.elements.find((function(t){return"product"===t.type})))return void this.next();this.active=!0,this.progress.items[d.start_position].animate(1e3*p.duration||5e3)}if(d.slides[d.start_position+1]&&!ce.match("image"===d.slides[d.start_position+1].type?d.slides[d.start_position+1].background:d.slides[d.start_position+1].preview)&&ce.add("image"===d.slides[d.start_position+1].type?d.slides[d.start_position+1].background:d.slides[d.start_position+1].preview),this.prevSlideContainer&&this.nextSlideContainer&&(this.prevSlideContainer.replaceChildren(h?this.buildPreview(h,g):""),this.nextSlideContainer.replaceChildren(m?this.buildPreview(m,b):"")),p.elements.find((function(t){return"products"===t.type}))?(this.carousel.innerHTML="",l=this.parent.createItem("product-wrapper","ul"),p.elements.find((function(t){return"products"===t.type})).products.forEach((function(t){var r=a.parent.createItem("carousel-product","li"),o=a.parent.createItem("carousel-product-img","img"),i=a.parent.createItem("carousel-product-name","a"),c=a.parent.createItem("carousel-product-category","p"),u=a.parent.createItem("carousel-product-price","div"),h=a.parent.createItem("carousel-product-new-price","p"),m=a.parent.createItem("carousel-product-discount","p");o.src=t.picture,o.setAttribute("title",t.name),o.setAttribute("alt",t.name),i.innerText=t.name,i.href=t.url,t.categories&&t.categories.length&&(c.innerText=t.categories[t.categories.length-1].name),t.discount_formatted&&t.oldprice>t.price?(m.innerText=t.discount_formatted,u.innerText=t.oldprice_formatted,h.innerText=t.price_formatted,u.append(m)):(u.innerText=t.price_formatted,h.innerText="",u.style.marginTop="27px"),r.append(o,i,c,u,h),r.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),a.parent.track("click",d.id,p.id).finally((function(){window.location=i.href}))})),l.append(r)})),window.innerWidth<180*l.children.length&&(l.style.justifyContent="left"),this.carousel.append(l)):this.container.parentNode.parentNode.querySelector("span[class*='-element-show-products']")&&this.container.parentNode.parentNode.querySelector("span[class*='-element-show-products']").remove(),p.elements.find((function(t){return"product"===t.type}))){var v=p.elements.find((function(t){return"product"===t.type}));this.container.classList.add("product-slide");var _=this.parent.createItem("slide-product-name","div"),w=this.parent.createItem("slide-product-img","img"),k=this.parent.createItem("slide-product-price","div"),P=this.parent.createItem("slide-product-price-new","div"),S=this.parent.createItem("slide-product-price-old","div"),C=this.parent.createItem("slide-product-price-promocode","div"),x=this.parent.createItem("slide-product-price-discount","div");_.innerHTML=v.item.name,y.startLoading(w),w.src=v.item.image_url_resized[520],w.setAttribute("title",v.item.name),w.setAttribute("alt",v.item.name),w.addEventListener("load",(function(t){y.stopLoading()}));var E=v.item.price_formatted,A=document.createElement("span");A.innerText=E.substring(E.length-1),P.innerText=E.substring(0,E.length-1),P.append(A),k.append(P),v.item.hasOwnProperty("oldprice_full")&&v.item.oldprice>v.item.price&&(P.style.gridRowStart=2,S.innerText=v.item.oldprice_full,S.append(A.cloneNode(!0)),k.append(S));var T=function calculateOptimalProductPriceFontSize(t){var r=t.lengthPrice,o=t.lengthPromo,i=t.innerWidth,a=t.innerHeight;if(!r||!o||"number"!=typeof r||"number"!=typeof o)return 10;for(var c=i<=480?.9*i:a/1.77*.9*.9-5,l=10,u=14*(r+o)+60;u>c&&l>1;)u=(r+o)*(--l/10*14)+60;return l}({innerHeight:window.innerHeight,innerWidth:window.innerWidth,lengthPrice:v.item.price_formatted&&v.item.price_formatted.length,lengthPromo:v.item.promocode&&v.item.promocode.length});if(k.style.fontSize="".concat(T,"px"),k.style.lineHeight="".concat(T,"px"),v.item.hasOwnProperty("promocode")){C.style.fontSize=2.4*T+"px",C.style.lineHeight=2.4*T+4+"px",C.innerHTML=v.item.promocode?'<div class="'.concat(this.parent.prefix(),'-slide-product-price-promocode-title">').concat(v.title,':</div><div class="').concat(this.parent.prefix(),'-slide-product-price-promocode-code">').concat(v.item.promocode,"</div>"):"проценты";var j=(0,oe.createCopyPromocodeBtn)(C,this.parent.prefix(),v.item.promocode,this.promocodeCopyText);C.appendChild(j),k.append(C)}else v.item.hasOwnProperty("discount_percent")?(x.innerHTML='<div class="'.concat(this.parent.prefix(),'-slide-product-price-discount-percent">').concat(v.item.discount_percent,"%</div>"),k.append(x)):P.style.paddingTop="8px";this.container.append(_),this.container.append(w),this.container.append(k)}this.container.append(c);for(var O=0;O<p.elements.length;O++)this.buildElement(p.elements[O],d.id,p.id);u&&this.container.append(u),this.parent.track("view",d.id,p.id),document.body.style.overflow="hidden"}},{key:"toggleCarousel",value:function toggleCarousel(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.container.querySelector("video");"block"===this.carousel.style.display?(t.textContent=r.show_carousel||"Used products",this.shadowLayer.style.display="none",this.carousel.style.display="none",this.active=!0,o&&o.play()):(t.textContent=r.hide_carousel||"Hide products",this.shadowLayer.style.display="block",this.carousel.style.display="block",this.active=!1,o&&o.pause())}},{key:"buildElement",value:function buildElement(t,r,o){var i,a,c,l=this;switch(t.type){case"button":(i=this.parent.createItem("element-button","a")).href=t.link,i.textContent=t.title,i.style.fontWeight=t.text_bold?"bold":"normal",i.style.backgroundColor=t.background||null,i.style.color=t.color||null;break;case"header":(i=this.parent.createItem("element-header","a")).href=t.link;var u=this.parent.createItem("element-header-avatar","img"),d=document.createElement("div"),p=this.parent.createItem("element-header-title"),h=this.parent.createItem("element-header-subtitle");u.src=t.icon,d.append(p,h),i.append(u,d),p.textContent=t.title,h.textContent=t.subtitle;break;case"products":a=this.parent.createItem("element-show-products","span");var m=this.parent.createItem("element-show-products-text","span"),y=this.parent.createItem("element-show-products-arrow-up","span");m.textContent=t.labels?t.labels.show_carousel:"Used products",a.append(m,y),this.container.parentNode.parentNode.append(this.shadowLayer),this.container.parentNode.parentNode.append(this.carousel),a.addEventListener("click",(function(r){r.stopPropagation(),r.preventDefault(),y.classList.toggle(l.parent.prefix()+"-element-show-products-arrow-up"),y.classList.toggle(l.parent.prefix()+"-element-show-products-arrow-down"),l.toggleCarousel(m,t.labels)})),this.container.querySelector("[class*='-button']")&&(this.container.querySelector("[class*='-button']").style.bottom="64px");break;case"text_block":c=createTextBlock(this.parent,t)}this.container.closest("div[class*='-background']").querySelector("[class*='-show-products']")&&this.container.closest("div[class*='-background']").querySelector("[class*='-show-products']").remove(),a&&this.container.closest("div[class*='-background']").append(a),c&&this.container.insertBefore(c,this.container.firstChild),i&&(i.addEventListener("click",(function click(t){t.preventDefault(),t.stopPropagation(),l.parent.track("click",r,o).finally((function(){window.location=i.href}))})),this.container.append(i))}},{key:"buildPreview",value:function buildPreview(t,r){var o=new Image,i="image"===t.type?t.background:t.preview;return o.src=i||r,o}}])}(),ae=function(){return stories_createClass((function ProgressBar(t,r){stories_classCallCheck(this,ProgressBar),this.story=r,this.progress=t.parent.createItem("progress"),this.items=this.story.slides.map((function(){return new se(t)}))}),[{key:"build",value:function build(){var t;return(t=this.progress).append.apply(t,_toConsumableArray(this.items.map((function(t){return t.build()})))),this.progress}},{key:"show",value:function show(){var t=this;this.items.forEach((function(r,o){t.story.start_position>o?r.set(100):r.set(0)}))}}])}(),se=function(){return stories_createClass((function Progress(t){stories_classCallCheck(this,Progress),this.div=t.parent.createItem("progress-item"),this.span=document.createElement("span"),this.div.append(this.span),this.progress=0,this.story_view=t}),[{key:"set",value:function set(t){this.progress=t,this.span.style.width=this.progress+"%"}},{key:"animate",value:function animate(t){var r=this;this.clear(),this.story_view.parent.interval=setInterval((function(){r.story_view.active&&(r.progress+=100/t*100,r.progress>=100?(r.clear(),r.set(100),r.story_view.next()):r.set(r.progress))}),100)}},{key:"clear",value:function clear(){this.story_view.parent.interval&&clearInterval(this.story_view.parent.interval)}},{key:"build",value:function build(){return this.div}}])}(),ce=new(function(){return stories_createClass((function cacheImages(){stories_classCallCheck(this,cacheImages),this.images=[]}),[{key:"add",value:function add(t){var r=this;setTimeout((function(){var o=new Image;o.src=t,r.images.push({url:t,media:o})}),100)}},{key:"get",value:function get(t){return this.images.find((function(r){return r.url===t})).media}},{key:"match",value:function match(t){return this.images.some((function(r){return r.url===t}))}}])}()),le=function(){return stories_createClass((function mediaLoader(t,r){stories_classCallCheck(this,mediaLoader),this.loadingImage=document.createElement("span"),this.loadingImage.classList.add("loader"),this.repeatBtn=document.createElement("span"),this.container=t,this.timer=0,this.loaded=!1,this.error_message=r||"Failed to retrieve data. Please check your connection and try again"}),[{key:"startLoading",value:function startLoading(t){var r=this;this.loaded=!1,this.container.append(this.loadingImage),t.addEventListener("error",(function(i){if(t.style.display="none",!r.container.querySelector(".loader-error")){var a=document.createElement("span");a.innerText=r.error_message,a.classList.add("loader-error"),r.container.append(a)}r.stopLoading(),clearInterval(o),r.createRepeatBtn(t)})),t.addEventListener("waiting",(function(t){r.loaded=!1,r.container.append(r.loadingImage)})),t.addEventListener("canplay",(function(t){r.stopLoading(),clearInterval(o)}));var o=setInterval((function(){r.loaded&&clearInterval(o),r.timer>15&&(t.style.display="none",r.timer=0,r.stopLoading(),r.createRepeatBtn(t)),r.timer++}),1e3)}},{key:"stopLoading",value:function stopLoading(){this.loaded||(this.loaded=!0,this.container.removeChild(this.loadingImage))}},{key:"createRepeatBtn",value:function createRepeatBtn(t){var r=this;if(this.container.querySelector(".loader-repeat"))return!0;this.repeatBtn.classList.add("loader-repeat"),t.style.display="none",this.repeatBtn.addEventListener("click",(function(o){o.preventDefault(),o.stopPropagation(),t.style.display="inline-block",r.container.removeChild(r.repeatBtn),r.container.querySelector(".loader-error")&&r.container.removeChild(r.container.querySelector(".loader-error")),t.readyState>2&&t.pause();var i=t.src.substring(0,t.src.length);t.setAttribute("src",i),t.setAttribute("type","video/".concat(i.substring(i.lastIndexOf(".")+1))),t.load(),r.startLoading(t)})),this.container.append(this.repeatBtn)}}])}();const ue=ne;var de=__webpack_require__(835);function core_typeof(t){return core_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},core_typeof(t)}function core_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,core_toPropertyKey(i.key),i)}}function _callSuper(t,r,o){return r=_getPrototypeOf(r),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(r,o||[],_getPrototypeOf(t).constructor):r.apply(t,o))}function _possibleConstructorReturn(t,r){if(r&&("object"==core_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function core_defineProperty(t,r,o){return(r=core_toPropertyKey(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function core_toPropertyKey(t){var r=function core_toPrimitive(t,r){if("object"!=core_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=core_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==core_typeof(r)?r:r+""}var pe=function(o){function Core(t){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function core_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Core),core_defineProperty(r=_callSuper(this,Core,[t,new w(o)]),"ajax",void 0),core_defineProperty(r,"api",void 0),core_defineProperty(r,"shop",void 0),core_defineProperty(r,"user",void 0),core_defineProperty(r,"storiesInstances",void 0),core_defineProperty(r,"source",void 0),r.label=o.label,r.storiesInstances=[],r.cookieless=!1,r.isSpa=!1,navigator.cookieEnabled||(r.cookieless=!0),r.detectPrivateMode(),r.domOnLoaded(),r.initRetries=0,r.user={did:null,id:null,email:null,profile:null,location:null,seance:null,tz:null},r.shop={token:null,currency:null,recommendations:!0,recommendersLazyLoad:!1},r.stream=null,r.recommendedBy=null,r.recommendedCode=null,r.source=null,r.collectedEmail=null,r.testMode=!1,r.testRecommenderMode=!1,r.promocode=new N(r).getFromCookie(),r.api=new k(window[r.label.fullName()+"_env"]||r.label.env,o.host,o.master_host,o.pictures_host),r.ajax=new x(r),r.reputation=new W(r),Core.isBot(r)?(r.logger.debug("Bot detected"),_possibleConstructorReturn(r)):!1===Core.corsAvailable()?(r.logger.debug("Very old browser"),_possibleConstructorReturn(r)):(r.addPreConnectedLinkToPage(r.api.getHost()),r.addPreConnectedLinkToPage(r.api.getPicturesHost()),r.registerSources(),r.init(),h.initDynamic(r),h.initCategory(r),h.initProducts(r),Y.initFullSearch(r),ue.init(r),r)}return function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(Core,o),function core_createClass(t,r,o){return r&&core_defineProperties(t.prototype,r),o&&core_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(Core,[{key:"init",value:function init(){var o=this;try{var i,a,c=this.queue.getInit();if(c[5]&&("object"===core_typeof(a=c[5])&&("cookieless"in a&&"boolean"==typeof a.cookieless&&(this.cookieless=a.cookieless),"did"in a&&(this.user.did=a.did)),this.cookieless&&this.logger.debug("Cookieless enabled")),c[6]&&(this.isSpa=c[6],this.isSpa&&this.logger.log("SPA enabled")),!c[1])return void console.error(this.label.fullName().toUpperCase()+": Incorrect shop_id");"string"==typeof c[2]&&(c[2].length<=16?this.stream=c[2]:this.logger.error("Stream max length 16"));var l={did:null!==(i=this.user.did)&&void 0!==i?i:r.default.get("".concat(this.label.fullName(),"_device_id"),this.areCookiesForbidden()),shop_id:c[1].trim()};if(this.shop.token=l.shop_id,this.user.did=l.did,this.user.tz=-1*Math.floor((new Date).getTimezoneOffset()/60),r.default.get(this.label.fullName()+"_session_code",this.areCookiesForbidden())){var u=r.default.get(this.label.fullName()+"_session_last_act",this.areCookiesForbidden());u&&parseInt(u)>=(new Date).getTime()-3600*t.SESSION_CODE_EXPIRE*1e3&&(l.sid=r.default.get(this.label.fullName()+"_session_code",this.areCookiesForbidden()),l.seance=l.sid)}this.user&&this.user.email&&(l.user_email=this.user.email),l.sid&&(this.user.seance=this.user.sid=l.sid),this.source&&this.source.from&&(l.from=this.source.from,l.code=this.source.code,this.source.map&&(l.map=this.source.map)),this.user&&this.user.tz&&(l.tz=this.user.tz);var d=c["string"==typeof c[2]?3:2]||null,p=c["string"==typeof c[2]?4:3]||null;this.initializeSegment(),this.ajax.sendGet(this.api.getAPIUrl("/init"),l).then((function(t){o.logger.debug("Application initialized"),o.initialized=!0;var i=!!o.user.did;o.user.did=t.did,o.setSeance(t.seance),a&&a.did&&a.did===o.user.did?o.logger.debug("Device ID '".concat(o.user.did,"' found in 'init', not saving to localStorage")):r.default.get("".concat(o.label.fullName(),"_device_id"),o.areCookiesForbidden())||r.default.set("".concat(o.label.fullName(),"_device_id"),o.user.did,{expires:31536e3,path:"/"},o),o.fetchSourceFromStore(),i||(h.initDynamic(o),h.initCategory(o),h.initProducts(o)),ue.init(o),o.user.profile=t.profile,o.shop.currency=t.currency,o.shop.token=c[1],o.shop.has_email=t.has_email,o.shop.email_collector=t.email_collector,o.shop.recommendations=t.recommendations,o.shop.recommendersLazyLoad=t.lazy_load||!1,t.voice&&(o.speech=new K(o,{codec:t.voice_codec})),t.search&&t.search.enabled&&(o.search=t.search,Y.initInstantSearch(o),Y.initFullSearch(o)),t.auto_css_recommender&&o.addStyleToPage("shop_css"),t.web_push_settings&&(o.web_push=new ee(o,t.web_push_settings)),t.popup&&b.prepare(o,t.popup),o.recone=new Q(o,t.recone),o.performCookieQueue(),"bitrix"===t.cms&&setInterval(o.performCookieQueue.bind(o),1e3),o.performQueue(),o.performErrorQueue(),o.email_collector(),"function"==typeof d&&d(t),t.snippets&&t.snippets.length>0&&t.snippets.forEach((function(t){try{var r=RegExp("(<\\/?script>|\\r?\\n|\\r)","ig"),i=t.code.replace(r,"");if(i.length>0){var a=document.createElement("script");a.dataset["".concat(o.label.fullName(),"_snippet_id")]=t.id,a.textContent="(function(){".concat(i,"})();"),document.body?document.body.appendChild(a):document.head?document.head.appendChild(a):o.logger.error("Snippet execution failed: "+t.name)}}catch(r){o.logger.error("Snippet execution failed: "+t.name),o.logger.error(r)}}))})).catch((function(t){o.logger.error(t,o),o.initRetries<2?(o.initRetries++,setTimeout((function(){o.push(c),o.init()}),2e3)):"function"==typeof p&&p()}))}catch(t){this.logger.error(t.message+":"+t.stack,this)}}},{key:"setSeance",value:function setSeance(o){this.user.sid=this.user.seance=o,r.default.set(this.label.fullName()+"_session_code",o,{expires:3600*t.SESSION_CODE_EXPIRE,path:"/"},this),r.default.set(this.label.fullName()+"_session_last_act",(new Date).getTime().toString(),{expires:3600*t.SESSION_CODE_EXPIRE,path:"/"},this)}},{key:"registerSources",value:function registerSources(){var t=Core.getUrlVars(this);this.vars=t,this.fetchRecommendedBy(t),this.source=this.fetchSources(t),this.search_query=t[this.label.name()+"_search_query"]||t.search||t.query||t.q,this.input_query=t[this.label.name()+"_input_query"],this.trackUTM(t),this.switchTestMode(t),this.switchNewRecommenderMode(t)}},{key:"initializeSegment",value:function initializeSegment(){this.segment=r.default.get("".concat(this.label.name(),"_segment"),this.areCookiesForbidden()),this.segment||(this.segment=["A","B"][Math.round(Math.random())],r.default.set("".concat(this.label.name(),"_segment"),this.segment,void 0,this))}},{key:"fetchSources",value:function fetchSources(t){var o={};return-1!==["bulk","chain","transactional"].indexOf(t.recommended_by)&&(t.bulk_code||t.mail_code)&&(o.from=t.recommended_by,o.code=t.bulk_code||t.mail_code,t.utm_link_map&&(o.map=t.utm_link_map)),"chain"===t.recommended_by&&t[this.label.fullName()+"_mail_code"]&&(o.from=t.recommended_by,o.code=t[this.label.fullName()+"_mail_code"]),"transactional"===t.recommended_by&&t[this.label.fullName()+"_mail_code"]&&(o.from="transactional",o.code=t[this.label.fullName()+"_mail_code"]),"transactional_sms"===t.recommended_by&&t[this.label.fullName()+"_transactional_sms_code"]&&(o.from="transactional_sms",o.code=t[this.label.fullName()+"_transactional_sms_code"]),void 0!==o.from?(r.default.set(this.label.fullName()+"_source",JSON.stringify(o),{expires:172800,path:"/"},this),o):null}},{key:"fetchSourceFromStore",value:function fetchSourceFromStore(){if(!this.source||void 0===this.source.from){var t=r.default.get(this.label.fullName()+"_source",this.areCookiesForbidden());t&&(t=JSON.parse(t))&&(this.source=t)}}},{key:"fetchRecommendedBy",value:function fetchRecommendedBy(t){(this.isSpa||-1!==["417dfce51c4cc3cc2fe3da5480db10","0fb6cf705ad4c77af1d2740301a950","74fd3b613553b97107bc4502752749"].indexOf(this.shop.token))&&(this.recommendedBy=null,this.recommendedCode=null,this.logger.debug("recommended_by cleared: ".concat(this.recommendedBy)),this.logger.debug("recommended_code cleared: ".concat(this.recommendedCode)));var r=t.recommended_by;null!=r&&""!==r&&(h.isTypeValid(r)?this.recommendedBy=r:this.logger.warn("Preparations: unexpected recommender type: ".concat(r))),(t[this.label.name()+"_search_query"]||t.recommended_code)&&(this.recommendedCode=t[this.label.name()+"_search_query"]||t.recommended_code)}},{key:"trackUTM",value:function trackUTM(t){var r={};for(var o in t)t.hasOwnProperty(o)&&o.match(/^utm_/i)&&(r[o.toLowerCase()]=t[o]);Object.keys(r).length&&this.push(["utm",r])}},{key:"switchTestMode",value:function switchTestMode(o){var i="".concat(this.label.fullName(),"_testmode");o.hasOwnProperty(i)?/(on|true|1)/.test(o[i].toLowerCase())?(this.testMode=!0,r.default.set(i,"true",{expires:t.EXPIRES_24H_SEC,path:"/"},this)):(this.testMode=!1,r.default.set(i,"false",{expires:-t.EXPIRES_24H_SEC,path:"/"},this)):"true"===r.default.get(i,this.areCookiesForbidden())&&(this.testMode=!0),this.testMode&&this.logger.debug("Test mode active")}},{key:"switchNewRecommenderMode",value:function switchNewRecommenderMode(o){var i="".concat(this.label.fullName(),"_test_recommender");o.hasOwnProperty(i)?/(on|true|1)/.test(o[i].toLowerCase())?(this.testRecommenderMode=!0,r.default.set(i,"true",{expires:t.EXPIRES_24H_SEC,path:"/"},this)):(this.testRecommenderMode=!1,r.default.set(i,"",{expires:-86400,path:"/"},this)):"true"===r.default.get(i,this.areCookiesForbidden())&&(this.testRecommenderMode=!0),this.testRecommenderMode&&this.logger.debug("Test recommender mode active")}},{key:"addStyleToPage",value:function addStyleToPage(t){var r="".concat(this.label.fullName(),"-").concat(t);if(!document.getElementById(r)){var o=document.createElement("link");o.setAttribute("id",r),o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href","//".concat(this.api.getMasterHost(),"/").concat(t,"/").concat(this.shop.token,".css")),document.getElementsByTagName("head")[0].appendChild(o)}}},{key:"addPreConnectedLinkToPage",value:function addPreConnectedLinkToPage(t){["dns-prefetch","preconnect"].forEach((function(r){var o=document.createElement("link");o.setAttribute("href","//".concat(t)),o.setAttribute("rel",r),document.head.appendChild(o)}))}},{key:"areCookiesForbidden",value:function areCookiesForbidden(){return this.cookieless}},{key:"updateSession",value:function updateSession(){this.isSpa&&(0,de.isSessionExpired)(this.label.fullName())&&(this.queue.findByName("init")||this.queue.push(["init",this.shop.token]),r.default.remove(this.label.fullName()+"_session_code"),this.init())}},{key:"perform",value:function perform(r){var o=this,i=r[0];switch(i&&void 0!==i||this.logger.warn("Undefined command"),i){case"did":"function"==typeof r[1]&&r[1](this.user.did);break;case"reset_session":this.setSeance(Core.guid());break;case"track":this.updateSession(),this.logger.debug('Track: Track "'.concat(r[1],'" with data "').concat(JSON.stringify(r[2]),'"'));try{if(-1!==["view","cart","remove_from_cart","category","wish","remove_wish","purchase","recone_click","recone_view","search"].indexOf(r[1]))this.fetchRecommendedBy(Core.getUrlVars(this)),new _(this,r[1],r[2],r[3]).send(this.recommendedBy,this.source);else if(r[1]){var a=Object.assign(r[2]||{},{shop_id:this.shop.token,did:this.user.did,sid:this.user.seance,event:r[1]});void 0===a.value||Number.isInteger(a.value)?this.ajax.sendPost(this.api.getAPIUrl("/push/custom"),a):this.logger.error("Custom event: value must be an integer")}}catch(t){this.logger.warn(t.message)}break;case"utm":this.logger.debug('Track: UTM with data "'.concat(JSON.stringify(r[1]),'"')),_.trackUTM(this,r[1]);break;case"recommend":if(this.logger.debug('Recommender: get "'.concat(r[1],'" with data "').concat(JSON.stringify(r[2]),'", "success" as "').concat(core_typeof(r[3]),'", failure as "').concat(core_typeof(r[4]),'" ')),"dynamic"===r[1])console.error("Dynamic recommender was deprecated syntax, please use: "+this.label.name()+"('recommend', CODE, params, success, failure)");else if(h.getTypes().indexOf(r[1])>=0)return void console.error("Recommender algorithm "+r[1]+" was deprecated, please use dynamic blocks");try{new h(this).get(r[2].code||r[1],r[2],r[3],r[4])}catch(t){this.logger.warn(t.message)}break;case"subscription":case"webpush_subscription":case"email_subscription":switch(r[1]){case"web_push_subscribe":var c=null,l=null;"function"==typeof r[2]&&(c=r[2]),"function"==typeof r[3]&&(l=r[3]),this.logger.debug("Web push subscribe method request"),this.web_push&&this.web_push.subscribe(!0).then(c).catch((function(t){if(!l)throw Error(t);l(t)}));break;case"web_push_supported":this.web_push&&"function"==typeof r[2]&&r[2](this.web_push.supported());break;case"web_push_subscribed":this.web_push&&"function"==typeof r[2]&&r[2](this.web_push.isSubscribed());break;case"check":if("function"==typeof r[2]){var u=r[2],p=null;"function"==typeof r[3]&&(p=r[3]),this.ajax.send("get",this.api.getAPIUrl("/subscriptions/check"),{shop_id:this.shop.token,did:this.user.did,sid:this.user.seance}).then(u).catch((function(t){if(!p)throw Error(t);p(t)}))}break;case"manage":if(!r[2]||"object"!==core_typeof(r[2])||Array.isArray(r[2])||!(r[2]instanceof Object))return this.logger.warn("Subscription Manage: the params shouldn't be empty");this.ajax.sendWithRetry("post",this.api.getAPIUrl("/subscriptions/manage"),Object.assign(r[2],{shop_id:this.shop.token,did:this.user.did,sid:this.user.seance,seance:this.user.seance,segment:this.segment||null}))}break;case"subscribe_trigger":new R(this).fetch(r[1],r[2]);break;case"unsubscribe_trigger":new R(this).fetchUnsubscribe(r[1],r[2]);break;case"check_trigger":new R(this).fetchCheck(r[1],r[2],r[3],r[4]);break;case"profile":this.logger.debug('Profile: "'.concat(r[1],'" with data "').concat(JSON.stringify(r[2]),'"'));try{"set"===r[1]?y.set(this,r[2],r[3],r[4]):"get"===r[1]&&y.get(this,r[2],r[3])}catch(t){this.logger.warn(t.message)}break;case"reputation":this.logger.debug('Reputation: "'.concat(r[1],'" with data "').concat(JSON.stringify(r[2]),'", "success" as "').concat(core_typeof(r[3]),'"'));try{this.reputation.perform(r[1],r[2],r[3])}catch(t){this.logger.warn(t.message)}break;case"add_css":"recommendations"===r[1]&&this.addStyleToPage("shop_css");break;case"search":if("string"==typeof r[1].search_query&&"function"==typeof r[2]&&this.search){var m,g={shop_id:this.shop.token,did:this.user.did,type:"full_search",sid:this.user.seance,seance:this.user.seance,search_query:r[1].search_query,input_query:r[1].input_query||this.input_query,exact_field_match:this.vars[this.label.name()+"_exact_field_match"]||null,limit:r[1].limit||null,category_limit:r[1].category_limit||null,page:r[1].page||null,offset:r[1].offset||null,brands:r[1].brands?r[1].brands.join(","):null,colors:r[1].colors?r[1].colors.join(","):null,fashion_sizes:r[1].fashion_sizes?r[1].fashion_sizes.join(","):null,locations:r[1].locations?r[1].locations.join(","):null,excluded_merchants:r[1].excluded_merchants?r[1].excluded_merchants.join(","):null,merchants:r[1].merchants?r[1].merchants.join(","):null,price_min:r[1].price_min||null,price_max:r[1].price_max||null,category_names:r[1].category_names?null:r[1].category_names,categories:r[1].categories?r[1].categories.join(","):null,widgetable:void 0!==r[1].widgetable?r[1].widgetable:null,available:void 0!==r[1].available?r[1].available:null,ignored:void 0!==r[1].ignored?r[1].ignored:null,extended:r[1].extended||null,filters:r[1].filters?JSON.stringify(r[1].filters):null,segment:r[1].segment,sort_by:r[1].sort_by||null,order:r[1].order||null,no_clarification:"boolean"==typeof r[1].no_clarification?r[1].no_clarification:null,filters_search_by:r[1].filters_search_by||null};Object.keys(g).forEach((function(t){return null===g[t]&&delete g[t]})),r[1].search_filters_block&&(m=new d(this,g,r[1].search_filters_block)),this.logger.debug("params: ".concat(JSON.stringify(g))),this.ajax.sendGet(this.api.getAPIUrl("/search"),g).then((function(t){r[2](t),m&&(m.setCallback(r[2]),m.print(t,!0)),t.popup&&"object"===core_typeof(t.popup)&&b.prepare(o,t.popup)})).catch((function(t){"function"==typeof r[3]&&r[3](t)}))}break;case"suggest":if("string"==typeof r[1].search_query&&"function"==typeof r[2]&&this.search){var v={shop_id:this.shop.token,did:this.user.did,type:"instant_search",search_query:r[1].search_query,categories:r[1].categories,locations:r[1].locations,subquery:!!r[1].categories,segment:r[1].segment,extended:r[1].extended||null,excluded_merchants:r[1].excluded_merchants?r[1].excluded_merchants.join(","):null,exact_field_match:this.vars[this.label.name()+"_exact_field_match"]||null};this.logger.debug("params: ".concat(JSON.stringify(v))),this.ajax.sendGet(this.api.getAPIUrl("/search"),v).then(r[2]).catch((function(t){"function"==typeof r[3]&&r[3](t)}))}break;case"search_collection":r[1].id&&"function"==typeof r[2]&&this.search&&this.ajax.sendGet(this.api.getAPIUrl("/search/collection"),{shop_id:this.shop.token,did:this.user.did,id:r[1].id}).then(r[2]);break;case"search_init":r[1]&&this.search&&Y.initInstantSearch(this);break;case"full_search_init":Y.initFullSearch(this);break;case"dynamic_init":h.initDynamic(this);break;case"category_init":h.initCategory(this);break;case"products_init":h.initProducts(this);break;case"stories_init":ue.init(this);break;case"start_stories":if(r[1]&&"string"==typeof r[1]){var w=r[1],k=function createStoryBlock(t,r){var o=document.createElement("div");return o.classList.add("".concat(t,"-stories")),o.setAttribute("data-code",r),o}(this.label.fullName(),w);new ue(this,k).startCampaign=!0}break;case"recone":this.logger.debug('RecOne: "'.concat(r[1],'" with data "').concat(JSON.stringify(r[2]),'", "success" as "').concat(core_typeof(r[3]),'"')),r[1]&&r[2]&&this.recone.perform(r[1],r[2],r[3]);break;case"say":this.speech&&this.speech.start(r[1]);break;case"get_promo_code":this.logger.debug('Promo code request data: "'.concat(JSON.stringify(r[1]),'", "success" as "').concat(core_typeof(r[2]),'", "error" as "').concat(core_typeof(r[3]),'"')),"function"==typeof r[2]?new N(this).get(r[1]).then((function(t){o.promocode=t,r[2](t)})).catch((function(t){"function"==typeof r[3]&&r[3](t)})):this.logger.error('Success Callback should have the type "function", the current type is "'.concat(core_typeof(r[2]),'"'));break;case"nps":switch(this.logger.debug('NPS request command as "'.concat(r[1],'", data as "').concat(JSON.stringify(r[2]),'", "success" as "').concat(core_typeof(r[3]),'", "error" as "').concat(core_typeof(r[4]),'"')),r[1]){case"review":A.setReview(this,r[2],r[3],r[4]);break;case"categories":A.getCategories(this,r[2],r[3]);break;case"channels":A.getChannels(this,r[2],r[3]);break;default:this.logger.warn("NPS: Undefined command: ".concat(r[1]))}break;case"segment":switch(this.logger.debug('Segments request command as "'.concat(r[1],'", data as "').concat(JSON.stringify(r[2]),'"')),r[1]){case"add":L.add(this,r[2]);break;case"remove":L.remove(this,r[2]);break;case"get":L.get(this,r[2],r[3]);break;default:this.logger.warn("Segments: Undefined command: ".concat(r[1]))}break;case"orders":if(this.logger.debug('Orders request command as "'.concat(r[1],'", data as "').concat(JSON.stringify(r[2]),'"')),"last_for_user"===r[1])j.last_for_user(this,r[2],r[3]);else this.logger.warn("Orders: Undefined command: ".concat(r[1]));break;case"products":if(this.logger.debug('Products request command as "'.concat(r[1],'", data as "').concat(JSON.stringify(r[2]),'"')),r[1]&&"object"===core_typeof(r[1])&&!Array.isArray(r[1]))re.fetchProducts(this,r[1]).then(r[2]||function(){}).catch(r[3]||console.error);else if("counters"===r[1])re.counters(this,r[2]).then(r[3]||function(){}).catch(r[4]||console.error);else this.logger.warn("Products: Undefined command: ".concat(r[1]));break;case"popup":this.logger.debug('Custom request show popup "'.concat(r[1],'"')),r[1]&&this.ajax.sendGet(this.api.getAPIUrl("/popup"),{shop_id:this.shop.token,did:this.user.did,sid:this.user.seance,id:r[1]}).then((function(t){return b.prepare(o,t,!0)}));break;case"cart":var P=r[1];if(!Object.values(t.CART_METHOD).includes(P)){this.logger.error("Need second argument to be in [ ".concat(Object.values(t.CART_METHOD)," ]"));break}var S=r[2],C=r[3];if(P===t.CART_METHOD.GET)this.ajax.sendGet(this.api.getAPIUrl("/products/cart"),{did:this.user.did,shop_id:this.shop.token}).then((function(t){return S&&"function"==typeof S?S(t):"success"===t.status?t.data:C&&"function"==typeof C?C(t):void o.logger.error("Error getting cart: ".concat(t.status))})).catch((function(t){if(C&&"function"==typeof C)return C(t);o.logger.error("Error getting cart: ".concat(t))}));break;case"debug":this.logger.warn("User: ".concat(JSON.stringify(this.user))),this.logger.warn("Shop: ".concat(JSON.stringify(this.shop))),this.logger.warn("Recommended by: ".concat(JSON.stringify(this.recommendedBy))),this.logger.warn("Source: ".concat(JSON.stringify(this.source)));break;default:this.logger.warn("Track: Undefined command: ".concat(r[0]))}}},{key:"performCookieQueue",value:function performCookieQueue(){try{var t=r.default.get(this.label.name()+"_events_track",this.areCookiesForbidden());if(!t)return;for(var o in r.default.set(this.label.name()+"_events_track","",{expires:-1,path:"/"},this),t=JSON.parse(t))t.hasOwnProperty(o)&&this.push(["track",o,t[o]])}catch(t){this.logger.warn("Error parse events cookie: ".concat(t))}}},{key:"performErrorQueue",value:function performErrorQueue(){var t=this;Object.keys(localStorage).map((function(r){t.performError(r)}))}},{key:"performError",value:function performError(t){var r=this;if(t.match(RegExp("^"+this.label.fullName()+"_error_.{8}-.{4}-.{4}-.{4}-.{12}$"))&&localStorage.hasOwnProperty(t)){var o=JSON.parse(localStorage.getItem(t));localStorage.removeItem(t),this.ajax.send(o.type,o.url,o.params).catch(function(t,o){return function(i){(0==i.code||i.code>=500)&&(t.attempt++,t.attempt<=10&&(t.time=(new Date).getTime(),localStorage.setItem(o,JSON.stringify(t)),r.handleError(o,500*t.attempt)))}}(o,t))}}},{key:"handleError",value:function handleError(t,r){var o=this;setTimeout((function(){o.performError(t)}),r)}},{key:"pushError",value:function pushError(t,r,o,i){if(0==t.code||t.code>=500){var a=this.label.fullName()+"_error_"+Core.guid();localStorage.setItem(a,JSON.stringify({attempt:1,time:(new Date).getTime(),type:r,url:o,params:i})),this.handleError(a,500)}}},{key:"detectPrivateMode",value:function detectPrivateMode(){var t=this;this.browserIsPrivateMode=!1,"undefined"!=typeof Promise&&new Promise((function(t){var r,o=function on(r){"function"==typeof r.preventDefault&&r.preventDefault(),t(!0)},i=function off(){t(!1)};window.webkitRequestFileSystem?webkitRequestFileSystem(0,0,i,o):"MozAppearance"in document.documentElement.style?((r=indexedDB.open("test")).onerror=o,r.onsuccess=i):/constructor/i.test(window.HTMLElement)?function tryls(){try{localStorage.length||(localStorage.x=1,localStorage.removeItem("x")),i()}catch(t){navigator.cookieEnabled?o():i()}}():window.indexedDB||!window.PointerEvent&&!window.MSPointerEvent?i():o()})).then((function(r){t.browserIsPrivateMode=r,r&&(t.logger.warn("This browser is private mode"),t.webPushSubscription&&(t.webPushSubscription.popupEnabled=!1,t.webPushSubscription.currentUserInfo.showed=!0,t.webPushSubscription.saveUserInfo()))}))}},{key:"domOnLoaded",value:function domOnLoaded(){this.onLoaded=!1;var t=function(){this.onLoaded||(this.onLoaded=!0,h.initDynamic(this),h.initCategory(this),h.initProducts(this),Y.initFullSearch(this),Y.initInstantSearch(this))}.bind(this);"complete"!=document.readyState&&(document.addEventListener?(document.addEventListener("DOMContentLoaded",t),window.addEventListener("load",t)):window.attachEvent&&window.attachEvent("onload",t))}},{key:"email_collector",value:function email_collector(){var t=this;if(this.shop.email_collector)var r=["login","mail","user","name"],o=setInterval((function(){var i=[document];[].forEach.call(document.getElementsByTagName("iframe"),(function(t){t.hasAttribute("src")&&t.src.length>0&&RegExp("^".concat(document.location.origin),"i").test(t.src)&&t.contentDocument&&i.push(t.contentDocument)})),[].forEach.call(i,(function(i){var a=i.getElementsByTagName("input");[].forEach.call(a,(function(i){if(!(i.classList.contains("".concat(t.label.fullName(),"-initialized"))||i.getAttribute("type")&&"hidden"===i.type.toLowerCase())){var a=i.attributes;a.length>0&&[].some.call(a,(function(a){var c=a.value;return r.some((function(r){return!!(c.toLowerCase().indexOf(r)+1)&&(i.classList.add("".concat(t.label.fullName(),"-initialized")),i.addEventListener("blur",(function(){var r=i.value.trim().toLowerCase();if(Core.validEmail(r)&&t.collectedEmail!==r){var a=RegExp("^.+(@|\\.)".concat(t.label.fullName(),"\\.com$"),"i");if(!Core.isHiddenTag(i)&&!a.test(r)&&!a.test(location.host)||t.logger.debugLevel){clearInterval(o),t.collectedEmail=r;var c={shop_id:t.shop.token,did:t.user.did,email:r};t.ajax.sendWithRetry("post",t.api.getAPIUrl("/subscriptions/collector"),c)}}})),!0)}))}))}}))}))}),300)}},{key:"isSafari",value:function isSafari(){return/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&window.safari.pushNotification).toString()}}],[{key:"getUrlVars",value:function getUrlVars(t){for(var r=window.location.search.substring(1).split("&"),o={},i=0;i<r.length;i++){var a=r[i].split("=");try{void 0===o[a[0]]?o[a[0]]=decodeURIComponent(a[1]):"string"==typeof o[a[0]]?o[a[0]]=[o[a[0]],decodeURIComponent(a[1])]:o[a[0]].push(decodeURIComponent(a[1]))}catch(o){t.logger.debug("Incorrect input value for decode: "+r[i])}}return o}},{key:"isBot",value:function isBot(t){return null!==navigator.userAgent.match(/Vercelbot|YandexMetrika|YaDirectFetcher|YandexAccessibilityBot|YandexAdNet|YandexBlogs|YandexCalendar|YandexDialogs|YandexDirect|YandexFavicons|YandexForDomain|YandexImages|YandexImageResizer|YandexMobileBot|YandexMobileScreenShotBot|YandexMarket|YandexNews|YandexOntoDB|YandexPagechecker|YandexPartner|YandexRCA|YandexRenderResourcesBot|YandexSearchShop|YandexSitelinks|YandexSpravBot|YandexTracker|YandexTurbo|YandexUserproxy|YandexVertis|YandexVerticals|YandexVideo|YandexScreenshotBot|Googlebot|AdsBot|BingPreview|bingbot|Screenshot Bot|YandexAntivirus|PEBOT|Googlebot-Mobile|Googlebot-Image|Google favicon|Mediapartners-Google|slurp|java|wget|curl|Commons-HttpClient|Python-urllib|libwww|httpunit|nutch|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|biglotron|teoma|convera|seekbot|gigablast|exabot|ngbot|ia_archiver|GingerCrawler|webmon |httrack|webcrawler|grub.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|bibnum.bnf|findlink|msrbot|panscient|yacybot|AISearchBot|IOI|ips-agent|tagoobot|MJ12bot|dotbot|woriobot|yanga|buzzbot|mlbot|yandexbot|purebot|Linguee Bot|Voyager|CyberPatrol|voilabot|baiduspider|citeseerxbot|spbot|twengabot|postrank|turnitinbot|scribdbot|page2rss|sitebot|linkdex|Adidxbot|blekkobot|ezooms|Mail.RU_Bot|discobot|heritrix|findthatfile|europarchive.org|NerdByNature.Bot|sistrix crawler|ahrefsbot|Aboundex|domaincrawler|wbsearchbot|summify|ccbot|edisterbot|seznambot|ec2linkfinder|gslfbot|aihitbot|intelium_bot|facebookexternalhit|yeti|RetrevoPageAnalyzer|lb-spider|sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net.com.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|seokicks-robot|it2media-domain-crawler|ip-web-crawler.com|siteexplorer.info|elisabot|proximic|changedetection|blexbot|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|Lipperhey SEO Service|CC Metadata Scaper|g00g1e.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Livelapbot|cXensebot|smtbot|bnf.fr_bot|A6-Indexer|ADmantX|Facebot|Twitterbot|OrangeBot|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|SemrushBot|yoozBot|lipperhey|y!j-asr|Domain Re-Animator Bot|AddThis|BitSightBot/i)||!RegExp("^demo.".concat(t.label.name()),"i").test(document.location.hostname)&&Core.isBrowserEmulator(t)}},{key:"isBrowserEmulator",value:function isBrowserEmulator(t){t.logger.debug("navigator.plugins:               ".concat(navigator.plugins instanceof PluginArray)),t.logger.debug("!Function.prototype.bind:        ".concat(!Function.prototype.bind)),t.logger.debug("window.Buffer:                   ".concat(window.Buffer)),t.logger.debug("window.webdriver:                ".concat(window.webdriver)),t.logger.debug("window.domAutomation:            ".concat(window.domAutomation)),t.logger.debug("window.domAutomationController:  ".concat(window.domAutomationController)),t.logger.debug("window.navigator.onLine:         ".concat(window.navigator.onLine));var r=navigator.plugins instanceof PluginArray==!1||window.callPhantom||window._phantom||!Function.prototype.bind||window.Buffer&&!window.personalization_buffer||window.emit||window.spawn||window.webdriver||window.domAutomation||window.domAutomationController||!1===window.navigator.onLine,o={};try{null[0]()}catch(t){o=t}return r||o.stack&&"string"==typeof o.stack&&o.stack.indexOf("phantom")>=0}},{key:"isMobile",value:function isMobile(){var t,r=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(r=!0),r}},{key:"corsAvailable",value:function corsAvailable(){return!(document.all&&!document.querySelector)}},{key:"validEmail",value:function validEmail(t){return-1!==t.indexOf("@")&&/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}},{key:"isHiddenTag",value:function isHiddenTag(t){var r=window.getComputedStyle?getComputedStyle(t,""):t.currentStyle;return void 0!==r.display&&"none"===r.display}},{key:"guid",value:function guid(){var t=function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}},{key:"eventPassiveSupported",value:function eventPassiveSupported(){var t=!1;try{var r=Object.defineProperty({},"passive",{get:function get(){t=!0}});window.addEventListener("test",null,r),window.removeEventListener("test",null,r)}catch(t){}return t}},{key:"addEvent",value:function addEvent(t,r,o){t.addEventListener?t.addEventListener(r,o,!!Core.eventPassiveSupported()&&{passive:!1}):t.attachEvent&&t.attachEvent("on"+r,o)}},{key:"dispatchEvent",value:function dispatchEvent(t,r){var o;document.createEvent?(o=document.createEvent("HTMLEvents")).initEvent(r,!0,!0):(o=document.createEventObject()).eventType=r,o.eventName=r,document.createEvent?t.dispatchEvent(o):t.fireEvent("on"+o.eventType,o)}},{key:"serializeToURLEncodedParams",value:function serializeToURLEncodedParams(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=[];if(Object.keys(t).length>0)for(var i in t){var a=r?"".concat(r,"[").concat(i,"]"):i,c=t[i];o.push(null!==c&&"object"===core_typeof(c)?Core.serializeToURLEncodedParams(c,a):encodeURIComponent(a)+"="+encodeURIComponent(c))}else r&&o.push(encodeURIComponent(r)+"=");return o.join("&")}},{key:"serializeToObject",value:function serializeToObject(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o={};if(Object.keys(t).length>0)for(var i in t){var a=r?"".concat(r,"[").concat(i,"]"):i,c=t[i];null!==c&&"object"===core_typeof(c)?o=Object.assign(o,Core.serializeToObject(c,a)):o[a]=c}else r&&(o[r]="");return o}}])}(D);const he=pe;function white_label_typeof(t){return white_label_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},white_label_typeof(t)}function white_label_defineProperties(t,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,white_label_toPropertyKey(i.key),i)}}function white_label_toPropertyKey(t){var r=function white_label_toPrimitive(t,r){if("object"!=white_label_typeof(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,r||"default");if("object"!=white_label_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==white_label_typeof(r)?r:r+""}var fe,me,ye=new(function(){return function white_label_createClass(t,r,o){return r&&white_label_defineProperties(t.prototype,r),o&&white_label_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}((function WhiteLabel(t,r,o,i){!function white_label_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,WhiteLabel),this.env=t,this._name=r,this._full_name=o,this._gdpr=i}),[{key:"name",value:function name(){return this._name}},{key:"fullName",value:function fullName(){return this._full_name}},{key:"gdpr",value:function gdpr(){return this._gdpr}}])}())("technodom","r46","rees46",!1);window[ye.name()]=(fe=window[ye.name()].q,me=new he(fe,{debug:!1,label:ye,host:"api.r46.technodom.kz",master_host:"cdn.r46.technodom.kz",pictures_host:"pictures.r46.technodom.kz"}),function(){me.push(arguments)})})(),o})()));